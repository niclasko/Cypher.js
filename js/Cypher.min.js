// https://github.com/niclasko/Cypher.js Copyright 2024 Niclas Kjall-Ohlsson.
function CypherJS(){{function W(){function o(){return[{},null]}var u=o(),s=1;this.recode=function(t){if(!t)return t;for(var e,n=t,i=(n.charAt||(n=""+t),u),r=0;r<n.length;r++)e=n.charAt(r),i[0][e]||(i[0][e]=o()),i=i[0][e];return i[1]||(i[1]=s++)}}function t(i){function n(t,e){if(e){if(s[e])throw"Node with ID "+e+" already exists in the database.";t.setId(e),s[e]=t}else t.setId(K()),s[t.id()]=t;for(key in t.getRawProperties())S(key,t.getLocalProperty(key),t.id());for(label in t.labels())L(label,t.id());i.statement().setNodesAdded(i.statement().getNodesAdded()+1)}function r(t,e){var n=null;if(e){if(s[e])throw"Relationship with ID "+e+" already exists in the database.";n=e}else n=G();for(key in t.setId(n),c[n]=t,m(t.getFromNode().id(),t.getToNode().id(),t.id()),t.getToNode().id()!=t.getFromNode().id()&&m(t.getToNode().id(),t.getFromNode().id(),t.id()),t.getProperties())C(key,t.getProperty(key),t.id());j(t.getType(),t.id()),t.setIsAdded(),i.statement().setRelationshipsAdded(i.statement().getRelationshipsAdded()+1)}var o=this,s=[],t=0,u={},a={},c=[],e=0,h={},f={},l={},d={},p={},g={},v=new W,y=function(t){return v.recode(t)},w=function(t,e){null!=t&&(h[t]||(h[t]={}),null==e||h[t][e]||(h[t][e]=[]))},b=function(t,e){if(w(t,e),null!=t){if(null!=e)return h[t][e];if(null==e){var n=[];for(nodeId in h[t])n=n.concat(h[t][nodeId]);return n}}return[]},m=function(t,e,n){w(t,e),h[t][e].push(n),E(t,n),P(e,n)},x=function(t){f[t]||(f[t]=[])},R=function(t){return x(t),f[t]},E=function(t,e){x(t),f[t].push(e)},N=function(t){l[t]||(l[t]=[])},O=function(t){return N(t),l[t]},P=function(t,e){N(t),l[t].push(e)},I=function(t,e){u[t]||(u[t]={}),u[t][e]||(u[t][e]=[])},T=function(t,e){t=y(t),e=y(e);return I(t,e),u[t][e]},A=function(t,e){d[t]||(d[t]={}),d[t][e]||(d[t][e]=[])},S=function(t,e,n){t=y(t),e=y(e);I(t,e),u[t][e].push(n)},C=function(t,e,n){t=y(t),e=y(e);A(t,e),d[t][e].push(n)},B=function(t){a[t]||(a[t]=[])},M=function(t){t=y(t);return B(t),a[t]},k=function(t){if(!p[t])return!(p[t]=[])},L=function(t,e){t=y(t);B(t);null==e||a[t].find(function(t){return t==e})||a[t].push(e)},j=(this._addLabelNodeIdLookup=function(t,e){L(t,e)},function(t,e){var n;null==e||(n=y(t),k(n),p[n].find(function(t){return t==e}))||(p[n].push(e),c[e].setStoredType(t))}),K=(this._addTypeRelationshipIdLookup=function(t,e){j(t,e)},function(){for(;s[t];)t++;return t}),G=function(){for(;c[e];)e++;return e},F=function(t,e,n){var i,r=[];if(t.isReferred()){if(t.isReferred()){var o=t.getReferredRelationship().getData();if(!o)throw"Expected relationship.";if(o.constructor!=gn&&o.constructor!=Q)throw"Expected relationship.";r.push(o.id())}}else e&&n?(i=b(e.id(),n.id()),r=r.concat(i)):e&&!n&&(i=R(e.id()),t.uniDirectional()&&i.concat(O(e.id())),r=r.concat(i));if(0==r.length)return!1;var u=new V;for(key in u.setMatchingSet(r,0),(t.leftDirection()||t.rightDirection())&&u.incrementToMatchCount(),t.getType()&&u.incrementToMatchCount(),t.getProperties())u.incrementToMatchCount();if(0<u.toMatchCount()){for(var s,a=0;a<r.length;a++)for(key in s=c[r[a]],!t.leftDirection()&&!t.rightDirection()||t.leftDirection()!=s.leftDirection(e.id())&&t.rightDirection()!=s.rightDirection(e.id())||u.keepMatchTally(r[a]),t.getType()&&s.getType()&&s.getType()==t.getType()&&u.keepMatchTally(r[a]),t.getProperties())t.getLocalProperty(key)==s.getLocalProperty(key)&&u.keepMatchTally(r[a]);u.updateMatchingSet()}return 0!=u.matchingSetSize()&&u.matchingSet()};function V(){var r=0,o=[],u=[];this.setMatchingSet=function(t,e){u=t,o=new Array(u.length).fill(null!=e?e:1)},this.addToMatchingSet=function(t){u.push(parseInt(t)),o.push(0)},this.updateMatchingSet=function(){for(var t=0,e=0;e<u.length;e++)o[e]==r&&t++;for(var n=new Array(t),i=0,e=0;e<u.length;e++)o[e]==r&&(n[i++]=u[e]);u=n,o=new Array(u.length).fill(r)},this.incrementToMatchCount=function(){r++},this.keepMatchTally=function(t){for(var e=0;e<u.length;e++)u[e]==t&&(o[e]=o[e]+1||1)},this.toMatchCount=function(){return r},this.matchingSet=function(){return u},this.matchingSetSize=function(){return u.length}}this.createNode=function(t){var e;t.isReferred()?(e=(e=t.getReferredNode().getData()).constructor==En?e.value():e).constructor==X&&(e=Sn.getNodeById(e.nodeId())):(t.bindProperties(),e=t.copy(),n(e),t.addMatchedNode(e)),t.outgoingRelationship()&&t.outgoingRelationship().setFromNode(e),t.incomingRelationship()&&(t.incomingRelationship().bindProperties(),t.incomingRelationship().setToNode(e),e=t.incomingRelationship().copy(),r(e),t.incomingRelationship().addMatchedRelationship(e)),t.nextNode()?t.nextNode().create():t.nextNode()||t.nextAction()};var _=function(t,e){var n;for(key in t.getProperties()){if(t.bindProperty(key),0==e.toMatchCount()&&0==e.matchingSetSize())(n=T(key,t.getLocalProperty(key)))&&e.setMatchingSet(n);else if(0<e.matchingSetSize())for(var i=0;i<e.matchingSetSize();i++)t.getLocalProperty(key)==s[e.matchingSet()[i]].getLocalProperty(key)&&e.keepMatchTally(e.matchingSet()[i]);e.incrementToMatchCount(),e.updateMatchingSet()}},H=function(t,e){var n;for(label in t.labels()){if(0==e.toMatchCount()&&0==e.matchingSetSize())(n=M(label))&&e.setMatchingSet(n);else if(0<e.matchingSetSize())for(var i=0;i<e.matchingSetSize();i++)s[e.matchingSet()[i]].hasLabel(label)&&e.keepMatchTally(e.matchingSet()[i]);e.incrementToMatchCount(),e.updateMatchingSet()}},D=function(t,e,n){if(t.nextNode()){if(t.getPattern().usedAsCondition())return t.nextNode().convey(e,n);t.nextNode().convey(e,n)}else if(!t.nextNode()){if(t.getPattern().usedAsCondition())return t.nextAction();t.nextAction()}},U=function(t){var e=[];if(0<t.matchingSetSize())e=t.matchingSet();else if(0==t.toMatchCount())for(var e=new Array(s.length),n=0;n<s.length;n++)e[n]=s[n].id();return e},q=function(t,e,n,i){!i&&t.outgoingRelationship().expandPath()&&0<e&&t.outgoingRelationship().resetExpandedPath(),t.isExpanded()||(t.addMatchedNode(s[n]),t.outgoingRelationship().setFromNode(s[n]));i=null;return t.outgoingRelationship().getNextObject().isReferred()&&!t.outgoingRelationship().hasVariablePathLength()&&(i=t.outgoingRelationship().getNextObject().getReferredNode().getData()),t.outgoingRelationship().bindProperties(),F(t.outgoingRelationship(),s[n],i)},z=function(t,e,n,i,r){for(var o,u=0;u<r.length;u++)if(o=c[[r[u]]],t.outgoingRelationship().pathLengthSatisfied()){if(t.outgoingRelationship().setExpandedEndNode(o.getToNode(e)),t.outgoingRelationship().setMatchedRelationship(o),t.outgoingRelationship().addMatchedRelationship(o,{fromNodeId:e,toNodeId:o.getToNode(e).id()}),t.getPattern().usedAsCondition()){if(null!=(o=D(t,n,i)))return o}else D(t,n,i);t.outgoingRelationship().setExpandedEndNode(null)}},J=function(t,e,n,i){if(t.outgoingRelationship().expandPath())for(var r=0;r<i.length;r++)relationship=c[[i[r]]],(t.outgoingRelationship().visitedBefore(relationship.getToNode(e).id())||(t.outgoingRelationship().pathLengthSatisfied()&&(t.setExpandedNode(relationship.getToNode(e)),o.matchNode(t,!1,(n||0)+1),t.setExpandedNode(null)),t.outgoingRelationship().expandPath()&&!n))&&t.outgoingRelationship().backTrackExpandedPath()};this.matchNode=function(t,e,n){var i=((t,e)=>{var n=[];if(t.isExpanded())t.isExpanded()&&(n=[t.getExpandedNode().id()]);else{var i=new V;if(t.isReferred()){var r=t.getReferredNode().getData();if(!(r=r.constructor==En?r.value():r))throw"Expected node.";if(r.constructor!=pn&&r.constructor!=X)throw"Expected node.";i.addToMatchingSet(r.id())}if(t.incomingRelationship()&&t.incomingRelationship().hasExpandedEndNode()&&!t.isReferred()&&i.addToMatchingSet(t.incomingRelationship().getExpandedEndNode().id()),_(t,i),H(t,i),0==(n=U(i)).length&&e)return!t.getPattern().usedAsCondition()&&void t.getPattern().create()}return n})(t,e);if(i&&i.length)for(var r=0;r<i.length;r++){var o,u=i[r];if(null!=(o=((t,e,n,i)=>{if(!t.incomingRelationship()&&!t.outgoingRelationship()){if(t.addMatchedNode(s[e]),t.getPattern().usedAsCondition())return D(t,n,i);D(t,n,i)}})(t,u,e,n)))return o;if(null!=(o=((t,e,n,i,r)=>{var o;if(t.outgoingRelationship()){e=q(t,e,n,r);if(!e&&i)t.getPattern().create(),o=-1;else if(0<e.length){if(null!=(o=z(t,n,i,r,e)))return o;if(null!=(o=J(t,n,r,e)));}}return o})(t,r,u,e,n)))return o;if(null!=(o=((t,e,n,i)=>{if(t.incomingRelationship()&&(t.addMatchedNode(s[e]),t.incomingRelationship().hasExpandedEndNode())){var e=!0;if(e=t.isReferred()&&t.getReferredNode().getData().id()!=t.incomingRelationship().getExpandedEndNode().id()?!1:e)if(t.getPattern().usedAsCondition()){if(null!=(e=D(t,n,i)))return e}else D(t,n,i)}})(t,u,e,n)))return o}if(t.getPattern().usedAsCondition())return!1},this.getNodeById=function(t){return s[t]},this.getRelationshipById=function(t){return c[t]},this.addNode=function(t){var e=new pn(this);e.setProperties(t.properties),e.setLabels(t.labels),n(e,t.id)},this.addRelationship=function(t){var e=new gn(Sn);e.setFromNode(this.getNodeById(t.from)),e.setToNode(this.getNodeById(t.to)),e.setProperties(t.properties),e.setType(t.type),r(e,t.id)},this.addTable=function(t){g[t.name()]=t},this.getTable=function(t){if(t in g)return g[t];throw'Table "'+t+'" does not exist.'}}function pn(t){function e(t){var e,n=this;for(e in t)this[e]=t[e];this.getId=function(){return n.id},this.getData=function(){return n},this.getObject=function(){return n},this.groupByKey=function(){return n.id},this.groupByValue=function(){return n}}var n,i,r,o,u,s,a=t,c={},h={},f={},l=null,d=null,p=this,g=!1,v=(this.setPreviousObject=function(t){r=t},this.getPreviousObject=function(){return r},this.setNextObject=function(t){o=t},this.getNextObject=function(){return o},this.setPattern=function(t){u=t},this.getPattern=function(){return u},this.nextNode=function(){if(p.getNextObject()){if(p.getNextObject().isRelationship())return p.getNextObject().getNextObject();if(p.getNextObject().isNode())return p.getNextObject()}return null},this.previousNode=function(){if(p.getPreviousObject()){if(p.getPreviousObject().isRelationship())return p.getPreviousObject().getPreviousObject();if(p.getPreviousObject().isNode())return p.getPreviousObject()}return null},this.incomingRelationship=function(){return p.getPreviousObject()&&p.getPreviousObject().isRelationship()?p.getPreviousObject():null},this.outgoingRelationship=function(){return p.getNextObject()&&p.getNextObject().isRelationship()?p.getNextObject():null},this.setId=function(t){n=t},this.id=function(){return n},this.getId=this.id,this.setProperty=function(t,e){f[t]=null,h[t]=e.value},this.setProperties=function(t){for(var e in t)f[e]=t[e]},this.bindProperty=function(t){f[t]=h[t]()},this.bindProperties=function(){for(var t in f)this.bindProperty(t)},this.setLabel=function(t,e){c[t]=!0,a._addLabelNodeIdLookup(t,e)},this.hasLabel=function(t){return c[t]},this.setLabels=function(t){for(var e in t)c[e]=t[e]},this.setVariableKey=function(t){i=t},this.getVariableKey=function(){return i},this.hasVariableKey=function(){return null!=i},this.getProperties=function(){return Object.create(f)},this.getRawProperties=function(){return f},this.labels=function(){return c},this.getLabels=function(){return Object.keys(c)},this.hasLabels=function(){return 0<Object.keys(c).length},this.hasProperties=function(){return 0<Object.keys(f).length},this.get=function(t){return t?n:new X(a,n)},this.toObject=function(){return new e({id:n,labels:this.getLabels(),properties:I(f),getProperty:function(){return f[key]},getProperties:function(){return this.properties},getLabels:function(){return this.labels},getKeys:function(){return this.properties.getKeys()}})},this.toString=function(){return JSON.stringify(this.get())},this.type=function(){return this.constructor.name},this.isRelationship=function(){return!1},this.isNode=function(){return!0},this.setReferredNode=function(t){l=t},this.isReferred=function(){return null!=l},this.getReferredNode=function(){return l},this.setExpandedIsMatched=function(){g=!0},this.expandedIsMatched=function(){return!!g&&!(g=!1)},this.setExpandedNode=function(t){d=t},this.isExpanded=function(){return null!=d},this.getExpandedNode=function(){return d},this.nextAction=function(){},this.setNextAction=function(t){this.nextAction=t},this.convey=function(t,e){return a.matchNode(p,t,e)},this.create=function(){return a.createNode(p)},this.merge=function(){return a.mergeNode(p)},this.match=function(){return a.matchNodes(p)},{});this.addMatchedNode=function(t){s=t.id()},this.getMatchedNode=function(){return this.getData()},this.addMatchedIncomingRelationshipId=function(t,e){v[t]||(v[t]=[]),v[t].push(e)},this.getMatchedIncomingRelationshipIds=function(t){var e;return v[t]?(e=v[t],v[t]=[],e):null},this.getData=function(){return a.getNodeById(s)},this.getLocalProperty=function(t){return f[t]||null},this.getProperty=function(t){return a.getNodeById(s)?a.getNodeById(s).getLocalProperty(t):null},this.groupByKey=function(){return this.getData().id()},this.groupByValue=function(){return this.getData().get()},this.copy=function(){var t=new pn(a);return t.setLabels(c),t.setProperties(f),t},this.mappable=function(){if(l&&l.mappable&&!l.mappable())return!1;for(var t in f)if(!h[t].mappable())return!1;return!0}}function gn(t){function e(t){for(var e in t)this[e]=t[e];this.getId=function(){return this.id},this.getData=function(){return this},this.getObject=function(){return this},this.groupByKey=function(){return this.id},this.groupByValue=function(){return this}}var n,i,r,o,u,s,a,c,h,f,l,d,p=t,g={},v={},y=!1,w=!1,b=1,m=1,x=null,R=(this.setPreviousObject=function(t){c=t},this.getPreviousObject=function(){return c},this.setNextObject=function(t){h=t},this.getNextObject=function(){return h},this.setPattern=function(t){f=t},this.getPattern=function(){return f},this.setId=function(t){n=t},this.id=function(){return n},this.setStoredType=function(t){i=t},this.setType=function(t,e){i=t},this.getType=function(){return i},this.setProperty=function(t,e){g[t]=null,v[t]=e.value},this.bindProperty=function(t){g[t]=v[t]()},this.bindProperties=function(){for(var t in g)this.bindProperty(t)},this.setProperties=function(t){for(var e in t)g[e]=t[e]},this.getProperty=function(t){return g[t]},this.getProperties=function(){return g},this.getRelationshipProperties=function(){return g},this.setFromNode=function(t){r=t},this.setToNode=function(t){o=t},this.getFromNode=function(t){return null!=t&&t!=r.id()?o:r},this.getToNode=function(t){return null!=t&&t!=r.id()?r:o},this.setLeftDirection=function(t){u=t},this.setRightDirection=function(t){s=t},this.leftDirection=function(t){return null!=t&&t!=r.id()?!u&&s:u&&!s},this.rightDirection=function(t){return null!=t&&t!=r.id()?!s&&u:s&&!u},this.uniDirectional=function(){return s&&u||!u&&!s},this.noDirection=function(){return!u&&!s},this.direction=function(){var t=this.leftDirection(),e=this.rightDirection();return t&&!e?"left":!t&&e?"right":t&&e?"both":"none"},this.type=function(){return this.constructor.name},this.isRelationship=function(){return!0},this.isNode=function(){return!1},this.setReferredRelationship=function(t){x=t},this.isReferred=function(){return null!=x},this.getReferredRelationship=function(){return x},this.isAdded=function(){return y},this.setIsAdded=function(){y=!0},this.setHasVariablePathLength=function(){w=!0,m=b=null},this.hasVariablePathLength=function(){return w},this.setPathLengthFrom=function(t){b=t},this.pathLengthFrom=function(){return b},this.setPathLengthTo=function(t){m=t},this.pathLengthTo=function(){return m},this.expandPath=function(){return w},this.get=function(){return new Q(p,n)},this.toObject=function(){return new e({id:n,type:i,properties:I(g),fromNode:r?r.get():null,toNode:o?o.get():null,direction:this.direction(),getProperty:function(){return g[key]},getProperties:function(){return g},getKeys:function(){return g.getKeys()},getType:function(){return i}})},this.toString=function(){var t="none";return this.leftDirection()?t="left":this.rightDirection()&&(t="right"),"id: "+n+". type: "+i+". properties: "+JSON.stringify(g)+". fromNodeId: "+(r?r.id():null)+". toNodeId: "+(o?o.id():null)+". direction: "+t},this.value=function(){return this.get()},this.setVariableKey=function(t){a=t},this.getVariableKey=function(){return a},this.hasVariableKey=function(){return null!=a},this.nextAction=function(){},this.setNextAction=function(t){this.nextAction=t},[]),E=[],N={},O=null,P=function(t){N[t]=(N[t]||0)+1};this.visitedBefore=function(t){return 1<R.length&&R[R.length-1]==R[R.length-2]||2<=N[t]},this.setMatchedRelationship=function(t){l=t.id()},this.addMatchedRelationship=function(t,e){w?(R.push(t.id()),E.push(e),e=e,0==R.length&&P(e.fromNodeId),P(e.toNodeId)):this.setMatchedRelationship(t)},this.getMatchedRelationship=function(){return this.getData()},this.hasExpandedEndNode=function(){return null!=O},this.setExpandedEndNode=function(t){O=t},this.getExpandedEndNode=function(){return O},this.setMatchingRelationshipIds=function(t){d=t},this.getMatchingRelationshipIds=function(){var t=null;return d&&(t=d.slice()),d=null,t},this.expandedPathLastItem=function(){return R[R.length-1]},this.backTrackExpandedPath=function(){var t;0!=R.length&&(R.pop(),t=E.pop(),0==R.length?N={}:N[t.toNodeId]--)},this.resetExpandedPath=function(){R=[],E=[],N={}},this.pathLengthFromSatisfied=function(){return!this.expandPath()||null==b||b&&R.length>=b},this.pathLengthToSatisfied=function(){return!this.expandPath()||null==m||m&&R.length<=m},this.pathLengthSatisfied=function(){return this.pathLengthFromSatisfied()&&this.pathLengthToSatisfied()},this.getExpandedPath=function(){return R},this.setShortestPath=function(t){R=t},this.getData=function(){return w?new wn(R,function(t){return p.getRelationshipById(t).value()}):p.getRelationshipById(l)},this.getLocalProperty=function(t){return g[t]||null},this.getProperty=function(t){return p.getRelationshipById(l)?p.getRelationshipById(l).getLocalProperty(t):null},this.groupByKey=function(){return this.getData().id()},this.groupByValue=function(){return this.getData().get()},this.copy=function(){var t=new gn(p);return t.setType(i),t.setProperties(g),t.setLeftDirection(u),t.setRightDirection(s),t.setFromNode(r),t.setToNode(o),t},this.mappable=function(){if(x&&x.mappable&&!x.mappable())return!1;for(var t in g)if(!v[t].mappable())return!1;return!0}}function vn(){function e(t){o.empty()||(o.lastObject().setNextObject(t),t.setPreviousObject(o.lastObject())),t.setPattern(o),i.push(t)}function t(){o.lastObject().setNextAction(function(){(a?h:f)()})}var n,i=[],r=[],u=[],o=this,s=!1,a=!1,c=Number.MAX_SAFE_INTEGER,h=function(){u[0].getExpandedPath().length<c&&(c=u[0].getExpandedPath().length,n=u[0].getExpandedPath().slice())},f=(this.shortestpath=function(){a=!0},this.addNode=function(t){r.push(t),e(t)},this.addRelationship=function(t){u.push(t),e(t)},this.nodeCount=function(){return this.nodes.length},this.relationshipCount=function(){return this.relationships.length},this.getData=function(){for(var t,n=[],e=[],i=0;i<u.length;i++)if(u[i].hasVariablePathLength()){if(u[i].hasVariablePathLength())for(var r=u[i].getData().value(),o=0;o<r.length;o++)t=r[o].getRelationship(),n.push(t.getFromNode().get(),t.get(),t.getToNode().get()),e.push(t.id())}else t=u[i].getData().value().getRelationship(),n.push(t.getFromNode().get(),t.get(),t.getToNode().get()),e.push(t.id());return(n=An(n)).getNodes=function(){for(var t=[],e=0;e<n.length;e+=3)0==e&&t.push(n[e]),t.push(n[e+2]);return An(t)},n.getRelationships=function(){for(var t=[],e=0;e<n.length;e+=3)t.push(n[e+1]);return An(t)},this.groupByKey=function(){return e},this.groupByValue=function(){return n},n},this.objects=function(){return i},this.getObject=function(t){return i[t]},this.lastObject=function(){return i[i.length-1]},this.getLast=this.lastObject,this.empty=function(){return 0==i.length},this.setNextAction=function(t){f=t},function(){});this.finish=function(){a&&(u[0].setShortestPath(n),f())};this.useAsCondition=function(){s=!0,o.lastObject().setNextAction(function(){return!0})},this.usedAsCondition=function(){return s},this.value=function(){return r[0].convey(!1)},this.match=function(){t(),r[0].convey(!1)},this.merge=function(){t(),r[0].convey(!0)},this.create=function(){t(),r[0].create()},this.mappable=function(){for(var t=0;t<i.length;t++)if(!i[t].mappable())return!1;return!0}}function yn(){function i(){for(var t in n)r[t]=n[t].value()}var n={},r={},o=[],e=this;this.addEntry=function(t,e){if(t in n)throw'Key "'+t+'" already exists in associative array.';n[t]=e,r[t]=null,o.push(t)},this.get=function(t=!0){i();var e,n={};for(e in r)n[e]=r[e],n[e]&&(n[e].constructor=r[e].constructor);return t?I(n):r},this.getProperty=function(t){return i(),r[t]},this.getProperties=function(){return Object.keys(n)},this.getValues=function(){return Object.values(n)},this.setValue=function(t,e){n[o[t]]=e},this.next=function(){return!1},this.hasNext=function(){return!0},this.reset=function(){},this.getData=function(){return e},this.getObject=function(){return e},this.value=function(t=!0){return e.get(t)},this.type=function(){return e.constructor.name},this.toString=function(){return i(),JSON.stringify(r)},this.groupByKey=function(){return e.toString()},this.groupByValue=function(){return e.get()}}function wn(r,o){var r=r&&r.constructor==Array&&r||[],u=An([]),t=this;this.add=function(t){t&&(r.push(t),u.push(null))},this.get=function(){if(o)for(t=0;t<r.length;t++)u[t]=o(r[t]);else for(var t=0;t<r.length;t++)u[t]=r[t].value();for(var e=new Array(u.length),n=0;n<u.length;n++)if(u[n].constructor==X||u[n].constructor==Q)e[n]=u[n];else for(var i in e[n]=u[n],e[n].constructor=u[n].constructor,u[n])e[n][i]&&(e[n][i].constructor=u[n][i].constructor);return An(e)},this.setElement=function(t,e){r[t]=e},this.getElements=function(){return r},this.next=function(){return!1},this.hasNext=function(){return!0},this.reset=function(){},this.getData=function(){return t},this.value=function(){return t.get()},this.type=function(){return t.constructor.name},this.groupByKey=function(){return t.get()},this.groupByValue=function(){return t.get()}}function bn(){var e,t=this,n=[],i=[];this.when=function(t){n.push(t)},this.whenCount=function(){return n.length},this.then=function(t){i.push(t)},this.else=function(t){e=t},this.get=function(){return this.value()},this.next=function(){return!1},this.hasNext=function(){return!0},this.reset=function(){},this.getData=function(){return t},this.value=function(){for(var t=0;t<n.length;t++)if(n[t].value())return i[t].value();return e.value()},this.type=function(){return t.constructor.name},this.groupByKey=function(){return t.get()},this.groupByValue=function(){return t.get()}}function mn(){var t=this,i=null,r=null,o=null,u=null;this.setPredicateFunctionName=function(t){i=t},this.variable=function(t){r=new d(null,t)},this.list=function(t){o=t},this.where=function(t){"setLocalVariable"in(u=t)&&r&&u.setLocalVariable(r.getObjectKey(),r)},this.get=function(){return this.value()},this.next=function(){return!1},this.hasNext=function(){return!0},this.reset=function(){},this.getData=function(){return t},this.value=function(){var t=o.value();if(t.constructor!=Array)throw"Predicate list must be an array.";for(var e=0,n=0;n<t.length;n++)r.setOverriddenValue(t[n]),u.value()&&e++;return"all"==i?e==t.length:"any"==i?0<e:"sum"==i&&e},this.type=function(){return t.constructor.name},this.groupByKey=function(){return t.get()},this.groupByValue=function(){return t.get()}}function xn(){var n=[];this.string=function(t){n.push(t)},this.expression=function(t){n.push(t)},this.get=function(){return this.value()},this.next=function(){return!1},this.hasNext=function(){return!0},this.reset=function(){},this.getData=function(){return me},this.value=function(){for(var t="",e=0;e<n.length;e++)n[e].value?t+=n[e].value():t+=n[e];return t},this.type=function(){return me.constructor.name},this.groupByKey=function(){return me.get()},this.groupByValue=function(){return me.get()}}function Rn(t){var e=t;this.get=function(){return e},this.next=function(){return!1},this.hasNext=function(){return!0},this.reset=function(){},this.getData=function(){return this},this.getObject=function(){return e},this.value=function(){return e},this.id=function(){return e.id},this.setValue=function(t){e=t},this.type=function(){return this.constructor.name},this.groupByKey=function(){return e},this.groupByValue=function(){return e}}function u(t,e){var n=e,i={};this.addColumn=function(t){return i[t]=new o(0,t),i[t]},this.addValue=function(t,e){i[t].addValue(e)},this.getColumn=function(t){return i[t]},this.name=function(){return n},t.addTable(this)}function o(t,e){var n=e,i=[],r=[],o=0,u=0;this.addValue=function(t){0<r.length?r[r.length-1]==t?i[i.length-1]++:r[r.length-1]!=t&&(r.push(t),i.push(1)):0==r.length&&(r.push(t),i.push(1))},this.value=function(){return i[o]<u&&(u=0,o++),u++,r[o]},this.reset=function(){u=o=0},this.name=function(){return n}}}function c(){try{return new XMLHttpRequest}catch(t){}return new function(){this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.status=null,this.responseText=null,this.response=null,this.responseType=null,this.method=null,this.url=null,this.async=!0,this.headers={},this.onreadystatechange=function(){},this.onload=function(){},this.setRequestHeader=function(t,e){this.headers[t]=e},this.open=function(t,e,n){this.method=t.toUpperCase(),this.url=e,this.async=n,this.readyState=this.OPENED},this.send=function(t){var e=null,n=null,i=0==this.url.indexOf("https");try{e=i?require("https"):require("http"),n=require("url")}catch(t){}function r(t){var e="";t.on("data",function(t){e+=t}),t.on("end",function(){u.responseText=e,u.response=e,u.readyState=u.DONE,u.status=200,u.onreadystatechange()})}function o(t){console.log("Error: "+t),u.status=0,u.onreadystatechange()}var u=this,n=new n.URL(this.url),i={hostname:n.hostname,port:n.port||(i?443:80),path:n.pathname+n.search};this.headers&&(i.headers=this.headers),"GET"==u.method?(e.get(i,r).on("error",o),this.onload(this)):"POST"==u.method&&(e.post(i,t,r).on("error",o),this.onload(this))}}}var p=new function(){function a(t,e,n){4==t.readyState&&(200==t.status?e(t.responseText):200!=t.status&&n(t.status+": "+t.responseText))}this.get=function(t,e,n,i){var r=c();r.onreadystatechange=function(){a(r,e,n)};try{if(r.open("GET",t,!0),i)for(var o in i)r.setRequestHeader(o,i[o]);r.send()}catch(t){n(t)}},this.post=function(t,e,n,i,r){var o,u=c();u.onreadystatechange=function(){a(u,n,i)};try{if(u.open("POST",t,!0),r)for(var s in r)u.setRequestHeader(s,r[s]);e.constructor==Object?(o=(new TextEncoder).encode(JSON.stringify(e)),u.setRequestHeader("Content-Type","application/json;charset=UTF-8"),u.setRequestHeader("Content-Length",o.length),u.send(o)):u.send(e)}catch(t){i(t)}}};{function jn(t,e,n,i,r,o){var u=t,s=u.element&&u.element().getKey?u.element().getKey():e,a=n,c=i,h=r,f={};if(a){c.addReduceExpression(this);for(var l=0;l<a.length;l++)a[l].setGroupBy(c.getGroupBy()),a[l].setReducer(c.getGroupBy().addReducer()),a[l].initialize()}var d=function(t){var e;return!!t&&(e=0)<t.length&&(!(!t[e].element().hasReferredVariables||!t[e].element().hasReferredVariables())||d(t[e].p))},p=d(u.p);if(this.root=function(){return u},this.rootObject=function(){return u.element().getObject?u.element().getObject():u.element()},this.value=function(){return u.value()},this.getData=function(){return this.value()},this.getAlias=function(){return s},this.variableReferences=function(){return h},this.hasReferredVariables=function(){return h&&0<h.length||p},this.setAlias=function(t){},this.hasKey=function(){return u.hasKey&&u.hasKey()},this.isReduceExpression=function(){return null!=a},this.aggregate=function(){if(a)for(var t=0;t<a.length;t++)a[t].aggregate();else c.getGroupBy().map(u)},this.hasAggregateFunctions=function(){return null!=a},this.isArray=function(){return u.element().constructor==wn},this.isAssociativeArray=function(){return u.element().constructor==yn},this.getAggregateFunctions=function(){return a},this.type=function(){return this.constructor.name},u.element().constructor==wn){t=u.element().getElements(),l=0;if(l<t.length)return void(t[l].hasAggregateFunctions&&(this.hasAggregateFunctions=function(){return!0}))}u.non_deterministic=function(){return o},this.mappable=function(){return u.mappable()},this.setLocalVariable=function(t,e){f[t]=e},this.getLocalVariable=function(t){return f[t]}}function d(t,e){var n=t,i=e,r=null;this.getObjectKey=function(){return i},this.getObject=function(){return r||(n.constructor==Rn?n.getObject():n)},this.value=function(t){if(r)return r;try{return n.getData().get(t)}catch(t){}return null},this.setOverriddenValue=function(t){r=t}}function h(t){var n,e,i=t,r=[],o={},u=[],s={nodes:{},relationships:{}},a=0,c=0,h=[],f=void 0,l=(this.addOperation=function(t){if(this.context()&&"Return"==this.context().type())throw"There can only be one return statement and it must be last in the query.";this.context()&&this.context().setNextOperation(t),r.push(t)},this.operations=function(){return r},this.context=function(){return f||r[r.length-1]},this.setContext=function(t){f&&h.push(f),f=t},this.resetContext=function(){f=h.pop()},this.addVariable=function(t,e){if(n=new d(e,t),o[t])throw"Variable `"+t+"` already declared.";o[t]=n},this.debugVariables=function(){for(var t in o)console.log('Variable "'+t+'":'),console.log(JSON.stringify(o[t].value()))},this.variables=function(){return Object.values(o)},this.getVariable=function(t){if(null!=o[t])return o[t];try{if(null!=window&&t in window)return{value:function(){return window[t]}}}catch(t){}throw"Variable `"+t+"` has not been declared."},this.hasVariable=function(t){return null!=o[t]},this.getLastVariable=function(){return n},this.setPropertyKey=function(t){e=t},this.getPropertyKey=function(){return e},this.clear=function(){r=[],o={},variableList=[],e=n=void 0,u=[],c=a=0,s={nodes:{},relationships:{}}},this.engine=function(){return i},this.results=function(){return l(),{output:u,graph:{nodes:Object.values(s.nodes),links:Object.values(s.relationships)},stats:{nodesAdded:a,relationshipsAdded:c}}},this.addOutputRecord=function(){u.push({})},this.addOutputEntry=function(t,e,n){null!=u[u.length-1][t]&&(t+=n),this.addOutputEntryToGraph(e),u[u.length-1][t]=g(e)},function(){var t,e,n=[];for(e in s.relationships)t=s.relationships[e],s.nodes[t.source]&&s.nodes[t.target]||n.push(e);for(var i=0;i<n.length;i++)delete s.relationships[n[i]]});this.addOutputEntryToGraph=function(t){if(t&&t.constructor==X)null==s.nodes[t.id()]&&(s.nodes[t.id()]=g(t));else if(t&&t.constructor==Q){var e;null==s.relationships[t.id()]&&((e=t.getObject().toObject()).source=e.fromNode.id(),e.target=e.toNode.id(),s.relationships[t.id()]=g(e))}else if(t&&t.constructor==Array)for(var n=0;n<t.length;n++)this.addOutputEntryToGraph(t[n])},this.setNodesAdded=function(t){a=t},this.setRelationshipsAdded=function(t){c=t},this.getNodesAdded=function(){return a},this.getRelationshipsAdded=function(){return c},this.setSuccessCallback=function(t){successCallback=t},this.success=function(){successCallback(this.results())}}function E(t){var e=t;this.evaluate=function(){return 1==e.value()}}function f(t,e){var i,n,r=[],o=new u(t,e);this.setPreviousOperation=function(t){var e;i=t;for(var n=0;n<i.variables().length;n++)e=i.variables()[n],r.push(o.addColumn(e.getObjectKey()))},this.setNextOperation=function(t){(n=t).setPreviousOperation(this)},this.variables=function(){return i.variables()},this.doIt=function(){for(var t,e=0;e<i.variables().length;e++)t=i.variables()[e],r[e].addValue(r[e].name(),t.value());n&&n.doIt()},this.finish=function(){n&&n.finish()},this.run=function(){throw"Into-operation cannot be first in statement."},this.type=function(){return this.constructor.name}}function l(){var i,e,n;function r(t,e,n){var i=t,r=e,o=n;this.set=function(){var t,e=i.getObject();if((e=e.constructor==En?e.value():e).constructor==X)t=e.getObject();else if(e.constructor==pn)t=e.getData();else if(e.constructor==Q)t=e.getObject();else{if(e.constructor!=gn)throw'Cannot assign to object of type "'+e.constructor.name+'".';t=e.getData()}try{t.setProperty(r,o),t.bindProperty(r)}catch(t){}}}function o(t,e){var n=t,i=e;this.set=function(){var t,e=n.getObject();if((e=e.constructor==En?e.value():e).constructor==X||e.constructor==Q)t=e.getObject();else{if(e.constructor!=pn&&e.constructor!=gn)throw'Cannot assign to object of type "'+e.constructor.name+'".';t=e.getData()}t.setProperties(i.value())}}function u(t,e){var n=t,i=e;this.set=function(){var t,e=n.getObject();if((e=e.constructor==En?e.value():e).constructor==X)t=e.getObject();else{if(e.constructor!=pn)throw'Cannot assign to object of type "'+e.constructor.name+'".';t=e.getData()}t.setLabel(i.value(),t.getId())}}function s(t,e){var n=t,i=e;this.set=function(){var t,e=n.getObject();if((e=e.constructor==En?e.value():e).constructor==Q)t=e.getObject();else{if(e.constructor!=gn)throw'Cannot assign to object of type "'+e.constructor.name+'".';t=e.getData()}try{t.setType(i.value(),t.id())}catch(t){}}}this.addSetter=function(t,e,n){(i=i||[]).push(new r(t,e,n))},this.addLabelSetter=function(t,e){(i=i||[]).push(new u(t,e))},this.addMapSetter=function(t,e){(i=i||[]).push(new o(t,e))},this.addTypeSetter=function(t,e){(i=i||[]).push(new s(t,e))},this.setPreviousOperation=function(t){e=t},this.setNextOperation=function(t){(n=t).setPreviousOperation(this)},this.variables=function(){return e.variables()},this.doIt=function(){for(var t=0;t<i.length;t++)i[t].set();n&&n.doIt()},this.finish=function(){n&&n.finish()},this.run=function(){throw"Set-operation cannot be first in statement."},this.type=function(){return this.constructor.name}}function v(t){function e(){i&&s().setNextAction(function(){r&&!r.evaluate()||i.doIt()})}var n,i,r,o=t,u=[],s=(this.where=function(t){r=new E(t)},this.addPattern=function(){u.push(new vn)},function(){return u[u.length-1]});this.getPattern=function(){return s()},this.addNode=function(t){s().addNode(t)},this.addRelationship=function(t){s().addRelationship(t)},this.variable=function(t){o.addVariable(t,this.getLast())},this.getLast=function(t){return s().lastObject()},this.setPreviousOperation=function(t){n=t},this.setNextOperation=function(t){(i=t).setPreviousOperation(this)},this.previousOperation=function(){return n};this.doIt=function(){if(n.constructor==a)throw"WITH is required between MERGE and CREATE";e(),this.doIt=function(){for(var t=0;t<u.length;t++)u[t].create()},this.doIt()},this.finish=function(){i?i.finish():o.success()},this.run=function(){e();for(var t=0;t<u.length;t++)u[t].create();i&&i.finish()},this.type=function(){return this.constructor.name},this.variables=function(){return o.variables()}}function y(t){function e(){i&&s().setNextAction(function(){r&&!r.evaluate()||i.doIt()})}var n,i,r,o=t,u=[],s=(this.where=function(t){r=new E(t)},this.addPattern=function(){u.push(new vn)},function(){return u[u.length-1]});this.getPattern=function(){return s()},this.addNode=function(t){s().addNode(t)},this.addRelationship=function(t){s().addRelationship(t)},this.variable=function(t){o.addVariable(t,this.getLast())},this.getLast=function(t){return s().lastObject()},this.setPreviousOperation=function(t){n=t},this.setNextOperation=function(t){(i=t).setPreviousOperation(this)},this.previousOperation=function(){return n};this.doIt=function(){if(n.constructor==a)throw"WITH is required between MERGE and MATCH";e(),this.doIt=function(){for(var t=0;t<u.length;t++)u[t].match()},this.doIt()},this.finish=function(){if(i){for(var t=0;t<u.length;t++)u[t].finish();i.finish()}else o.success()},this.run=function(){e();for(var t=0;t<u.length;t++)u[t].match();if(i){for(t=0;t<u.length;t++)u[t].finish();i.finish()}},this.type=function(){return this.constructor.name},this.variables=function(){return o.variables()}}function a(t){function e(){i&&s().setNextAction(function(){r&&!r.evaluate()||i.doIt()})}var n,i,r,o=t,u=[],s=(this.where=function(t){r=new E(t)},this.addPattern=function(){u.push(new vn)},function(){return u[u.length-1]});this.addNode=function(t){s().addNode(t)},this.addRelationship=function(t){s().addRelationship(t)},this.getLast=function(t){return s().lastObject()},this.variable=function(t){this.getLast().setVariableKey(t),o.addVariable(t,this.getLast())},this.setPreviousOperation=function(t){n=t},this.setNextOperation=function(t){(i=t).setPreviousOperation(this)},this.previousOperation=function(){return n};this.doIt=function(){e(),this.doIt=function(){s().merge()},this.doIt()},this.finish=function(){i?i.finish():o.success()},this.run=function(){e(),s().merge(),i&&i.finish()},this.type=function(){return this.constructor.name},this.variables=function(){return o.variables()}}function N(n){function i(t){return{value:t,map:{}}}var r,t=null,e=0,o=new W,u=(this.getTrieRoot=function(){return t},this.beginMap=function(){r=t=null==t?i():t},this.beginMap(),this.map=function(t){t.non_deterministic()&&t.precalculate();var e=null==(e=t.groupByKey())?e:e.constructor==X||e.constructor==Q?e.id():e.constructor==Array||e.constructor==Object?JSON.stringify(e):o.recode(e),t=t.groupByValue();r.map[e]||(r.map[e]=i(t)),r=r.map[e]},this.getReducer=function(t){return r.reducers||(r.reducers=new Array(e)),r.reducers[t]||(r.reducers[t]={}),r.reducers[t]},this.addReducer=function(){return e++},this.print=function(){u(t)},function(t){for(var e in t.map)n.setNextMapValue(t.map[e].value),u(t.map[e]),n.moveToPreviousMapValue();e||(r=t,n.addAggregateOutputRecord())})}function O(t,e,n,i){var r,o=t,u=e,s=o.getAlias(),a=0,c=this,h=i,f=n;this.getAlias=function(){return s},this.setAlias=function(t){s=t,u.addVariable(s,this)},this.hasKey=function(){return o.hasKey()},this.setId=function(t){a=t},this.getId=function(){return a},this.value=function(){return null!=r?r:o.value()},this.groupByKey=function(){return this.value()},this.groupByValue=function(){return this.value()},this.get=function(){return c.value()},this.getData=function(){return c},this.getExpression=function(){return o},this.setGroupByValue=function(t){o.isArray()&&o.hasAggregateFunctions()||(r=t)},this.nextAction=function(){},this.setNextAction=function(t){this.nextAction=t},this.hidden=function(){return h},this.parent=function(){return f},this.type=function(){return this.constructor.name}}function i(t){function e(){if(y++,g.hasGroupBy()){if(g.hasGroupBy()){if(n.beginMap(),a)for(t=0;t<a.length;t++)a[t].getExpression().aggregate();for(t=0;t<i.length;t++)i[t].aggregate()}}else if(m()&&!b()){for(var t=0;t<h.length;t++)h[t].nextAction();v++,o&&o.doIt()}}var n,a,i,r,o,u,s,c=t,h=[],f=0,l=!1,d=!1,p=!1,g=this,v=0,y=0,w=(this.where=function(t){u=new E(t)},this.limit=function(t){s=t},this.expression=function(t){x(t)},this.getLast=function(){return h[R()]},this.getGroupBy=function(){return n=null==n?new N(this):n},this.hasGroupBy=function(){return null!=n},this.hasMapKeys=function(){return a&&0<a.length},this.doItCount=function(){return y},function(){return null!=s}),b=function(){return w()&&v>=s.value()},m=function(){return!u||u.evaluate()},x=(this.addReduceExpression=function(t){(i=i||[]).push(t)},this.setNextMapValue=function(t){a[f++].setGroupByValue(t)},this.moveToPreviousMapValue=function(){f--},this.addAggregateOutputRecord=function(){if(m()&&!(0==this.doItCount()&&this.hasMapKeys()||b())){for(var t=0;t<h.length;t++)h[t].nextAction();v++,o&&o.doIt()}},this.setReturnValueNextAction=function(t){t.setNextAction(function(){0==t.getId()&&c.addOutputRecord(),t.hidden()||c.addOutputEntry(t.getAlias(),t.value(),t.getId())})},function(t,e){var n=!1;if(t.isArray())for(var i=t.root().element(),r=0;r<i.getElements().length;r++){var o=x(i.getElements()[r],!0);i.setElement(r,o),n=!0}else if(t.isAssociativeArray())for(var u=t.root().element(),s=u.getValues(),r=0;r<s.length;r++){o=x(s[r],!0);u.setValue(r,o),n=!0}e=new O(t,c,g,e);return h.push(e),h[R()].setId(R()),e.getExpression().isReduceExpression()||n||!e.getExpression().mappable()||(a=a||[]).push(e),g.setReturnValueNextAction(e),d=d||t.hasReferredVariables(),p=!d,e}),R=(this.setIsIntermediary=function(){l=!0},this.conveyorBeltEnd=function(){return!d&&l&&!i&&!p},function(){return h.length-1});this.setPreviousOperation=function(t){r=t},this.setNextOperation=function(t){(o=t).setPreviousOperation(this)},this.previousOperation=function(){return r},this.nextOperation=function(){return o},this.variables=function(){if(!o&&r)return r.variables();for(var t=[],e=0;e<h.length;e++)h[e].hidden()||t.push(c.getVariable(h[e].getAlias()));return t},this.type=function(){return this.constructor.name};this.doIt=function(){this.conveyorBeltEnd()||e()},this.finish=function(){this.conveyorBeltEnd()&&e(),this.hasGroupBy()&&n.print(),o?o.finish():c.success()},this.run=function(){e(),(o||this).finish()}}function w(t){var e=new i(t),n=this.constructor.name;return e.setReturnValueNextAction=function(t){t.hidden()||t.setNextAction(function(){e.hasGroupBy()&&Bn.getVariable(t.getAlias()).setOverriddenValue(t.value())})},e.type=function(){return n},e.setIsIntermediary(),e}function En(t){var e,n,i,r,o,u=t,s=0;this.doIt=function(){if(n&&(r=i.value())){if(!Array.isArray(r))throw"Unwind expects list expression.";for(s=0;s<r.length;s++)n.doIt()}},this.finish=function(){n&&n.finish()},this.run=function(){this.doIt(),n&&n.finish()},this.variable=function(t){o=t,u.addVariable(t,this)},this.variables=function(){return[u.getVariable(o)]},this.expression=function(t){i=t},this.setPreviousOperation=function(t){e=t},this.setNextOperation=function(t){(n=t).setPreviousOperation(this)},this.previousOperation=function(){return e},this.nextOperation=function(){return n},this.value=function(){return r[s]},this.groupByKey=this.value,this.groupByValue=this.value,this.get=function(){return this.value()},this.getData=function(){return this},this.type=function(){return this.constructor.name},this.id=function(){return this.value().id()},this.collection=function(){return r},this.index=function(){return s}}function b(t){function o(t,e){for(var n=[],i=0,r={},o=0,u="",s=0,a=!1,c=t||",",h=function(){pc=u,u=x.charAt(s++),d()&&(a=!a,h())},f=function(){return y()?"\0":x.charAt(s)},l=function(){return!(!p||'"'!=u||'"'!=f())},d=function(){return!l()&&'"'==u},p=function(){return a},g=function(){return u==c},v=function(){return"\r"==u&&"\n"==f()&&h(),"\n"==u},y=function(){return s>=x.length},w=function(){for(var t="";!(g()||v()||y())||p();)t+=l()?(u=x.charAt(++s),'""'):u,h();0==o&&n.push(m?t:n.length),(0<o&&m||!m)&&(r[n[i++]]=t),g()&&h()};!y();){for(;!v()&&!y();)w();0<o++&&(b=r,r={},i=0,e()),h()}}function u(t,e){if(t.constructor==Array)for(var n=0;n<t.length;n++)b=I(t[n]),e();else t.constructor==Object&&(b=I(t),e())}var b,e,n=t,i=null,r="GET",s=null,m=!1,a=",",c=null,x=null,h=null,f=0,l=0,d=n.engine().getDataDownloadProxy();this.runCount=function(){return f},this.increaseRunCount=function(){f++},this.getRunId=function(){return++l},this.csv=function(){i="CSV"},this.json=function(){i="JSON"},this.text=function(){i="TEXT"},this.post=function(){r="POST"},this.loadType=function(){return i},this.getRequestType=function(){return r},this.getPayload=function(){return s?s.value():null},this.headers=function(){m=!0},this.setHTTPHeaders=function(t){this.httpHeaders=t},this.setFieldTerminator=function(t){if(1<t.length||0==t.length)throw"Field terminator must be one char.";a=t},this.fieldTerminator=function(){return a},this.expression=function(t){null==c?c=t:null==s&&(s=t)},this.getLast=function(){return c},this.variable=function(t){n.addVariable(t,this)},this.getProperty=function(t){return b[t]},this.from=function(){return d?d+c.value():c.value()},this.get=function(){return b},this.value=function(){return this.get()},this.groupByKey=function(){return b},this.groupByValue=function(){return this.get()},this.getData=function(){return this},this.statement=function(){return n},this.setPreviousOperation=function(t){e=t},this.setNextOperation=function(t){(h=t).setPreviousOperation(this)},this.previousOperation=function(){return e},this.variables=function(){return n.variables()};this.doIt=function(){this.run()},this.finish=function(){},this.run=function(){function t(t){var e=i.getRunId();"CSV"==i.loadType()?(x=t,o(i.fieldTerminator(),function(){h.doIt()})):"JSON"==i.loadType()?u(JSON.parse(t),function(){h.doIt()}):"TEXT"==i.loadType()&&(b=t,h.doIt()),e==i.runCount()&&h.finish()}function e(e){e="Error loading data from "+r+": "+e;try{self.onerror(e)}catch(t){throw e}}var n,i=this,r=i.from();i.increaseRunCount();if(r.constructor==String)try{"GET"==i.getRequestType()?p.get(i.from(),t,e,i.httpHeaders?i.httpHeaders.value(!1):null):"POST"==i.getRequestType()&&p.post(i.from(),i.getPayload(),t,e,i.httpHeaders?i.httpHeaders.value(!1):null)}catch(t){e(t)}else r.constructor!=String&&"JSON"==i.loadType()&&(n=i.getRunId(),u(r,function(){h.doIt()}),n==i.runCount())&&h.finish()},this.type=function(){return this.constructor.name}}}{var e=function(t){var e,n={};for(key in t){for(var i=t[key].displayValue(),r=n,o=0;o<i.length;o++)r[e=i.charAt(o).toUpperCase()]||(r[e]={}),r=r[e];r.isF=!0,r.f=t[key]}return n},n=function(t,e,n,i,r){for(var o,u=e,s=i,a=function(t){return n.charAt(t).toUpperCase()};;){if(!u[a(s)])return 0;if((u=u[a(s)]).isF&&!u[a(s+1)]&&(o=s+1,!!r||" "==a(o)||"("==a(o)||")"==a(o)||","==a(o)||""==a(o)||"}"==a(o)||"\t"==a(o)||"\n"==a(o)||"\r"==a(o)||"/"==a(o)&&"/"==a(o+1)))return t.latestParsed=u.f,s-i+1;s++}};{function Nn(t,e){this.action=e,this.displayValue=function(){return t}}Nn.f={},Nn.f.CREATE=new Nn("CREATE",function(t){t.create()}),Nn.f.MATCH=new Nn("MATCH",function(t){t.match()}),Nn.f.MERGE=new Nn("MERGE",function(t){t.merge()}),Nn.f.WITH=new Nn("WITH",function(t){t._with()}),Nn.f.RETURN=new Nn("RETURN",function(t){t._return()}),Nn.f.INTO=new Nn("INTO",function(t){t.into()}),Nn.f.LIMIT=new Nn("LIMIT",function(t){}),Nn.f.UNWIND=new Nn("UNWIND",function(t){t.unwind()}),Nn.f.WHERE=new Nn("WHERE",function(t){}),Nn.f.LOAD=new Nn("LOAD",function(t){t.load()}),Nn.f.CSV=new Nn("CSV",function(t){t.csv()}),Nn.f.JSON=new Nn("JSON",function(t){t.json()}),Nn.f.TEXT=new Nn("TEXT",function(t){t.text()}),Nn.f.HEADERS=new Nn("HEADERS",function(t){}),Nn.f.FROM=new Nn("FROM",function(t){}),Nn.f.POST=new Nn("POST",function(t){t.post()}),Nn.f.AS=new Nn("AS",function(t){}),Nn.f.FIELDTERMINATOR=new Nn("FIELDTERMINATOR",function(t){}),Nn.f.SET=new Nn("SET",function(t){}),Nn.f.DISTINCT=new Nn("DISTINCT",function(t){}),Nn.f.TRUE=new Nn("TRUE",function(t){}),Nn.f.FALSE=new Nn("FALSE",function(t){}),Nn.f.NULL=new Nn("NULL",function(t){}),Nn.f.CASE=new Nn("CASE",function(t){}),Nn.f.WHEN=new Nn("WHEN",function(t){}),Nn.f.THEN=new Nn("THEN",function(t){}),Nn.f.ELSE=new Nn("ELSE",function(t){}),Nn.f.END=new Nn("END",function(t){}),Nn.f.SHORTESTPATH=new Nn("SHORTESTPATH",function(t){}),Nn.f.IN=new Nn("IN",function(t){}),Nn.trie=e(Nn.f),Nn.isKeyWord=function(t,e){return n(Nn,Nn.trie,t,e)}}{function On(t,e,n,i){this.value=i,this.isOperator=!0,this.displayValue=function(){return t},this.precedence=function(){return e},this.leftAssociativity=function(){return n},this.rightAssociativity=function(){return!n}}On.f={},On.f.POWER=new On("^",11,!1,function(){return Math.pow(this.lhs.value(),this.rhs.value())}),On.f.MULTIPLY=new On("*",10,!0,function(){return this.lhs.value()*this.rhs.value()}),On.f.DIVIDE=new On("/",10,!0,function(){return this.lhs.value()/this.rhs.value()}),On.f.MODULO=new On("%",10,!0,function(){return this.lhs.value()%this.rhs.value()}),On.f.SET_UNION=new On("|",10,!0,function(){try{return Array.from(new Set(this.lhs.value().concat(this.rhs.value())))}catch(t){return console.log(t),null}}),On.f.SET_INTERSECT=new On("&",10,!0,function(){try{var t,e=new Set(this.lhs.value()),n=new Set(this.rhs.value()),i=new Set;for(t of n)e.has(t)&&i.add(t);return Array.from(i)}catch(t){return console.log(t),null}}),On.f.PLUS=new On("+",9,!0,function(){return this.lhs.value().constructor==Array?this.lhs.value().concat(this.rhs.value()):this.rhs.value().constructor==Array?[this.lhs.value()].concat(this.rhs.value()):this.lhs.value()+this.rhs.value()}),On.f.MINUS=new On("-",9,!0,function(){var t=this.lhs.value(),e=this.rhs.value();if(t.constructor!=Array||e.constructor!=Array)return t-e;var n,i=new Set(t);for(n of new Set(e))i.delete(n);return Array.from(i)}),On.f.GREATER_THAN=new On(">",8,!0,function(){return this.lhs.value()>this.rhs.value()}),On.f.LESS_THAN=new On("<",8,!0,function(){return this.lhs.value()<this.rhs.value()}),On.f.GREATER_THAN_OR_EQUALS=new On(">=",8,!0,function(){return this.lhs.value()>=this.rhs.value()}),On.f.LESS_THAN_OR_EQUALS=new On("<=",8,!0,function(){return this.lhs.value()<=this.rhs.value()}),On.f.EQUALS=new On("=",7,!0,function(){return this.lhs.value()==this.rhs.value()}),On.f.NOT_EQUALS=new On("<>",7,!0,function(){return this.lhs.value()!=this.rhs.value()}),On.f.IN=new On("IN",7,!0,function(){if(this.rhs.value().constructor==Array)return-1<this.rhs.value().indexOf(this.lhs.value());throw"Not a list expression."}),On.f.IS=new On("IS",7,!0,function(){return this.lhs.value()==this.rhs.value()}),On.f.AND=new On("AND",6,!0,function(){return this.lhs.value()&&this.rhs.value()}),On.f.OR=new On("OR",5,!0,function(){return this.lhs.value()||this.rhs.value()}),On.f.NONE=new On("NONE",-1,!0,null),On.trie=e(On.f),On.latestParsed=null,On.isOperator=function(t,e){return n(On,On.trie,t,e,!0)}}{function Pn(t,e,n,i,r){var o=t,u=e,s=n,a=r;this.value=i,this.getObject=i,this.groupByKey=i,this.groupByValue=i,this.isFunction=!0,this.displayValue=function(){return o},this.parametric=function(){return 0<u},this.precedence=function(){return 12},this.leftAssociativity=function(){return!0},this.rightAssociativity=function(){return!this.leftAssociativity},this.verifyParsedParameterCount=function(t){if(t<u)throw'Too few parameters for function "'+o+'".';if(s<t)throw'Too many parameters for function "'+o+'".'},this.returnType=function(){return a}}Pn.f={},Pn.f.PI=new Pn("PI",0,0,function(){return Math.PI}),Pn.f.E=new Pn("E",0,0,function(){return Math.E}),Pn.f.exp=new Pn("exp",1,1,function(){return Math.pow(Math.E,this.p[0].value())}),Pn.f.sqrt=new Pn("sqrt",1,1,function(){return Math.sqrt(this.p[0].value())}),Pn.f.log=new Pn("log",2,2,function(){return Math.log(this.p[0].value())/(this.p[1].value()?Math.log(this.p[1].value()):1)}),Pn.f.ln=new Pn("ln",1,1,function(){return Math.log(this.p[0].value())}),Pn.f.sin=new Pn("sin",1,1,function(){return Math.sin(this.p[0].value())}),Pn.f.cos=new Pn("cos",1,1,function(){return Math.cos(this.p[0].value())}),Pn.f.id=new Pn("id",1,1,function(){return this.p[0].value().id()}),Pn.f.labels=new Pn("labels",1,1,function(){return this.p[0].value().getLabels()}),Pn.f.type=new Pn("type",1,1,function(){return this.p[0].value().getType()}),Pn.f.startnode=new Pn("startnode",1,1,function(){return this.p[0].value().startNode()}),Pn.f.endnode=new Pn("endnode",1,1,function(){return this.p[0].value().endNode()}),Pn.f.properties=new Pn("properties",1,1,function(){return this.p[0].value().getProperties()}),Pn.f.exists=new Pn("exists",1,1,function(){return null!=this.p[0].value()}),Pn.f.keys=new Pn("keys",1,1,function(){try{return this.p[0].value().getKeys()}catch(t){}return Object.keys(this.p[0].value())}),Pn.f.nodes=new Pn("nodes",1,1,function(){return this.p[0].value().getNodes()}),Pn.f.relationships=new Pn("relationships",1,1,function(){return this.p[0].value().getRelationships()}),Pn.f.head=new Pn("head",1,1,function(){return this.p[0].value().shift?this.p[0].value().shift():null}),Pn.f.last=new Pn("last",1,1,function(){return 0<this.p[0].value().length?this.p[0].value()[this.p[0].value().length-1]:null}),Pn.f.size=new Pn("size",1,1,function(){return this.p[0].value().length}),Pn.f.object_lookup=new Pn("object_lookup",2,2,function(){if(this.p[0].value().getProperty)return this.p[0].value().getProperty(this.p[1].value());try{return this.p[0].value()[this.p[1].value()]}catch(t){}return null}),Pn.f.array_lookup=new Pn("array_lookup",2,2,function(){try{var t=this.p[1].value();if(t.constructor==Number||t.constructor==String)return this.p[0].value()[t];if(t.constructor==Array){for(var e=[],n=0;n<t.length;n++)e.push(this.p[0].value()[t[n]]);return e}}catch(t){}return null}),Pn.f.split=new Pn("split",2,2,function(){return An(this.p[0].value().split(this.p[1].value()))},wn),Pn.f.join=new Pn("join",1,2,function(){var t=null!=this.p[1]&&this.p[1].value()||",";return this.p[0].value().join(t)}),Pn.f.trim=new Pn("trim",1,1,function(){return this.p[0].value().trim()}),Pn.f.range=new Pn("range",2,3,function(){var t=parseInt(this.p[0].value()),e=parseInt(this.p[1].value()),n=null!=this.p[2]&&parseInt(this.p[2].value())||1;if(0==n)throw"Zero step-size not allowed";if(n<0&&0<e&&t<e)throw"Negative step-size and positive end of range not allowed.";if(0<n&&e<0)throw"Positive step-size and negative end of range not allowed.";if(e<t&&0<n)throw"End of range smaller than start of range and positive step-size not allowed.";for(var i=[],r=t;r!=e;r+=n)i.push(r);return An(i)},wn),Pn.f.lower=new Pn("lower",1,1,function(){return this.p[0].value().toLowerCase()}),Pn.f.upper=new Pn("upper",1,1,function(){return this.p[0].value().toUpperCase()}),Pn.f.replace=new Pn("replace",3,3,function(){var t=this.p[0].value();return t.replace?t.replace(new RegExp(this.p[1].value(),"g"),this.p[2].value()):t}),Pn.f.toint=new Pn("toint",1,1,function(){return parseInt(this.p[0].value())}),Pn.f.tofloat=new Pn("tofloat",1,1,function(){return parseFloat(this.p[0].value())}),Pn.f.tostring=new Pn("tostring",1,1,function(){try{return this.p[0].value().toString()}catch(t){}return this.p[0].value()+""}),Pn.f.stringify=new Pn("stringify",2,2,function(){try{return JSON.stringify(this.p[0].value(),null,this.p[1].value())}catch(t){}return null}),Pn.f.todate=new Pn("todate",1,1,function(){return new Date(this.p[0].value())}),Pn.f.tojson=new Pn("tojson",1,1,function(){return JSON.parse(this.p[0].value())}),Pn.f.coalesce=new Pn("coalesce",2,2,function(){return(null==this.p[0].value()?this.p[1]:this.p[0]).value()}),Pn.f.round=new Pn("round",1,1,function(){return Math.round(this.p[0].value())}),Pn.f.rand=new Pn("rand",0,0,function(){return Math.random()}),Pn.f.rand.non_deterministic=!0,Pn.f.timestamp=new Pn("timestamp",0,0,function(){return new Date}),Pn.f.not=new Pn("not",1,1,function(){return!this.p[0].value()}),Pn.trie=e(Pn.f),Pn.latestParsed=null,Pn.isFunction=function(t,e){return n(Pn,Pn.trie,t,e)}}{function In(t,e,n,i,r,o,u){var s=t,a=0,c=e,h=n,f=u;this.initialize=i,this.value=r,this.getObject=r,this.aggregate=o,this.isFunction=!0,this.initializeIfNecessary=function(){this.initialize()},this.displayValue=function(){return s},this.precedence=function(){return 12},this.leftAssociativity=function(){return!0},this.rightAssociativity=function(){return!this.leftAssociativity},this.parametric=function(){return 0<c},this.parsedParameterCount=function(){return a},this.verifyParsedParameterCount=function(t){if((a=t)<c)throw'Too few parameters for function "'+s+'".';if(h<a)throw'Too many parameters for function "'+s+'".'},this.returnType=function(){return f}}In.f={},In.f.sum=new In("sum",1,1,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.getGroupBy().getReducer(this.getReducerId()).result=0)},function(){return this.getGroupBy().getReducer(this.getReducerId()).result||new Number(0)},function(){this.initializeIfNecessary(),this.getGroupBy().getReducer(this.getReducerId()).result+=this.p[0].value()}),In.f.barchart=new In("barchart",1,1,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.getGroupBy().getReducer(this.getReducerId()).result={})},function(){return I(this.getGroupBy().getReducer(this.getReducerId()).result)},function(){this.initializeIfNecessary();var t=this.p[0].value().groupByKey&&this.p[0].value().groupByKey()||this.p[0].value();null==this.getGroupBy().getReducer(this.getReducerId()).result[t]&&(this.getGroupBy().getReducer(this.getReducerId()).result[t]=0),this.getGroupBy().getReducer(this.getReducerId()).result[t]++}),In.f.histogram=new In("histogram",1,2,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.getGroupBy().getReducer(this.getReducerId()).result={values:[],histogram:null})},function(){var t=this.getGroupBy().getReducer(this.getReducerId()).result;if(null==t.histogram){for(var e=this.p[1]&&this.p[1].value()||10,n=t.values[0],i=t.values[0],r=new Array(e).fill(0),o=0;o<t.values.length;o++)t.values[o]<n&&(n=t.values[o]),t.values[o]>i&&(i=t.values[o]);for(var u=(i-n)/e,o=0;o<t.values.length;o++)r[Math.floor(t.values[o]/u)]++;t.histogram=new Array(e);for(var s=n,o=0;o<e;o++)t.histogram[o]={label:"["+s+", "+(s+u)+">",value:r[o],from:s,to:s+u},s+=u}return An(t.histogram)},function(){this.initializeIfNecessary(),this.getGroupBy().getReducer(this.getReducerId()).result.values.push(this.p[0].value())}),In.f.min=new In("min",1,1,function(){},function(){return this.getGroupBy().getReducer(this.getReducerId()).result},function(){(null==this.getGroupBy().getReducer(this.getReducerId()).result||this.p[0].value()<this.getGroupBy().getReducer(this.getReducerId()).result)&&(this.getGroupBy().getReducer(this.getReducerId()).result=this.p[0].value())}),In.f.max=new In("max",1,1,function(){},function(){return this.getGroupBy().getReducer(this.getReducerId()).result},function(){(null==this.getGroupBy().getReducer(this.getReducerId()).result||this.p[0].value()>this.getGroupBy().getReducer(this.getReducerId()).result)&&(this.getGroupBy().getReducer(this.getReducerId()).result=this.p[0].value())}),In.f.count=new In("count",1,1,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.distinct()?this.distinct()&&(this.getGroupBy().getReducer(this.getReducerId()).result={}):this.getGroupBy().getReducer(this.getReducerId()).result=0)},function(){return this.distinct()?this.distinct()?Object.keys(this.getGroupBy().getReducer(this.getReducerId()).result).length:void 0:this.getGroupBy().getReducer(this.getReducerId()).result||new Number(0)},function(){var t;this.initializeIfNecessary(),this.distinct()?this.distinct()&&(t=this.p[0].value().groupByKey&&this.p[0].value().groupByKey()||this.p[0].value(),t=JSON.stringify(t),null==this.getGroupBy().getReducer(this.getReducerId()).result[t])&&(this.getGroupBy().getReducer(this.getReducerId()).result[t]=!0):this.getGroupBy().getReducer(this.getReducerId()).result+=1}),In.f.stdev=new In("stdev",1,1,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.getGroupBy().getReducer(this.getReducerId()).result=[])},function(){for(var t=0,e=this.getGroupBy().getReducer(this.getReducerId()).result,n=0;n<e.length;n++)t+=e[n];for(var i=t/e.length,t=0,n=0;n<e.length;n++)t+=Math.pow(e[n]-i,2);return Math.sqrt(t/(e.length-1))},function(){this.initializeIfNecessary(),this.getGroupBy().getReducer(this.getReducerId()).result.push(this.p[0].value())}),In.f.collect=new In("collect",1,1,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.distinct()?this.distinct()&&(this.getGroupBy().getReducer(this.getReducerId()).result={}):this.getGroupBy().getReducer(this.getReducerId()).result=An([]))},function(){return this.distinct()?this.distinct()?An(Object.values(this.getGroupBy().getReducer(this.getReducerId()).result)):void 0:this.getGroupBy().getReducer(this.getReducerId()).result||An([])},function(){this.initializeIfNecessary();var t=this.p[0].value();null!=t&&(this.distinct()?this.distinct()&&(t=this.p[0].value().groupByKey&&this.p[0].value().groupByKey()||this.p[0].value(),t=JSON.stringify(t),null==this.getGroupBy().getReducer(this.getReducerId()).result[t])&&(this.getGroupBy().getReducer(this.getReducerId()).result[t]=this.p[0].value()):this.getGroupBy().getReducer(this.getReducerId()).result.push(this.p[0].value()))},wn),In.trie=e(In.f),In.latestParsed=null,In.isAggregateFunction=function(t,e){return n(In,In.trie,t,e)}}{function Tn(t){var e=t;this.displayValue=function(){return e}}Tn.f={},Tn.f.sum=new Tn("sum"),Tn.f.all=new Tn("all"),Tn.f.any=new Tn("any"),Tn.trie=e(Tn.f),Tn.latestParsed=null,Tn.isPredicateFunction=function(t,e){return n(Tn,Tn.trie,t,e)}}function m(C){for(var i,f=C,e=void 0,r=0,o="",u=!1,M="(): {}\"',.\n+-/*^[]=<>!",n={},s=!1,k=function(){s=!0},K=function(){var t=s;return s=!1,t},a=(this.statementText=function(){return i},this.position=function(){return r},0),G=function(){return 0<a},F=function(){a++},_=function(){a--},H=0;H<M.length;H++)n[M[H]]=!0;this.parse=function(t){i=t,o="",s=!1,a=r=0,U()};var U=function(){if(j(),(z()||ht()||ct()||ft()||Y()||Z()||q())&&U(),N())throw D("Expected keyword.")},q=function(){return j(),!!xe()&&(h(),f.expression(),Dt(),t(),!0)},z=function(){if(j(),me()){if(j(),Re()){if(j(),ge(!0)){if(j(),!Oe())throw D("Expected HEADERS-keyword.");f.statement().context().headers()}if(j(),!Pe())throw D("Expected FROM-keyword.");if(J(),Q(),j(),!Vt())throw D("Expected alias.")}else{if(!Ee()&&!Ne())throw D("Expected CSV-, JSON-, or TEXT-keyword.");if(j(),!Pe())throw D("Expected FROM-keyword.");J(),j();var t=!1;if(Oe()&&(X(),t=!0),j(),Ie()&&W(),j(),!t&&Oe()&&X(),j(),!Vt())throw D("Expected alias.")}return!0}return!1},J=function(){h(),f.expression()},W=function(){h(),f.expression()},X=function(){var t=vt();if(!t)throw D("Expected associative array.");f.statement().context().setHTTPHeaders(t)},Q=function(){if(j(),Ae()){if(j(),!St())throw D("Expected single- or doublequoted string.");f.statement().context().setFieldTerminator(E())}},Y=function(){return j(),!(!ge()||!$(!0)||(t(),0))},Z=function(){return j(),!!ve()&&$()},$=function(t){do{if(j(),Ze())Wt();else if(h(),f.expression(),!jt()&&t&&!f.lastObject().hasKey())throw D("Expression in WITH must be aliased (use AS).")}while(S());if(c(),j(),lt(),j(),ye()){if(j(),!Ot())throw D("Expected table name.");f.insertInto(E())}return!0},tt=function(t){if(B()){if(t&&f.pattern(),f.node(),d(!0)){var t=E(),e=Pt(),n=p();if(e||n){if(f.variableExists(t))throw"It is not allowed to create a new node in this context.";f.variable(t)}else if(f.variableExists(t)){e=f.getVariable(t).getObject();if(e.constructor!=En&&!e.isNode())throw"Variable `"+t+"` is bound to a "+e.type()+".";f.lastObject().setReferredNode(e)}else f.variable(t)}else Pt(),p();if(L())return!0;throw D("Expecting closing parentheses.")}return!1},et=function(){if(Ze()){if("Merge"==f.operation()||"Create"==f.operation())throw"Variable path length not supported in this context.";if(f.context().setHasVariablePathLength(),He()&&f.context().setPathLengthFrom(parseInt(E())),I()){if(!I())throw D('Expected "."');He()&&f.context().setPathLengthTo(parseInt(E()))}return!0}return!1},nt=function(){var t=Je();if(Xe()){if(f.relationship(),t&&f.leftDirection(),cn()){if(d(!0)){var t=E(),e=It(),n=p(),i=et();if(e||n||i){if(f.variableExists(t))throw"It is not allowed to create a new relationship in this context.";f.variable(t)}else if(f.variableExists(t)){e=f.getVariable(t).getObject();if(!e.isRelationship())throw"Variable `"+t+"` is bound to a "+e.type()+".";f.lastObject().setReferredRelationship(e)}else f.variable(t)}else It(),p(),et();if(!hn())throw D("Expected closing square bracket.");if(Xe())return We()&&f.rightDirection(),!0;throw D("Expected relationship line.")}throw D("Expected opening square bracket.")}return!1},it=function(){if(Ue(),B()){r--;var e=!1;try{var t=rt();if(t){for(;st(t);)if(!rt(t))throw D("Expecting node pattern.");return t.element().useAsCondition(),Bn.resetContext(),t}}catch(t){throw e=!0,Bn.resetContext(),t}e||Bn.resetContext()}return!1},rt=function(t){var e,n=!1;if(Ue(),B()){if(k(),e=l(),t||(t=Qt(new vn),Bn.setContext(t.element())),t.element().addNode(new pn(Sn)),e&&ot(e)&&(t.element().lastObject().setReferredNode(e),n=!0),Pt()&&(n=!0),p()&&(n=!0),L())return ut(t.element().lastObject())?t:(qe(),Yt(),!1);if(n)throw D("Expecting closing parentheses.");qe(),Yt()}return!1},ot=function(t){return t.rootObject().constructor==pn},ut=function(t){return 0<t.getLabels().length||0<t.getProperties().length||!!t.getReferredNode()||0==t.getLabels().length&&0==t.getProperties().length&&!t.getReferredNode()},st=function(t){var e,n=Je();if(Xe()){if(t.element().addRelationship(new gn(Sn)),n&&t.element().leftDirection(),cn()){if(d(!0)){n=E();if(!f.variableExists(n))throw'Variable "'+n+'" does not exist.';if(!(e=f.getVariable(n).getObject()).isRelationship())throw"Variable `"+n+"` is bound to a "+e.type()+".";t.element().lastObject().setReferredRelationship(f.getVariable(n).getObject())}if(It(),p(),et()&&e)throw"Path expansion not allowed for referred relationship.";if(!hn())throw D("Expected closing square bracket.");if(Xe())return We()&&f.rightDirection(),!0;throw D("Expected relationship line.")}throw D("Expected opening square bracket.")}return!1},at=function(t){var e=void 0;if(d(!0)){if(j(),t&&en())throw D("Path variable not allowed in this context.");if(e=E(),!en())throw D("Expected variable assignment.");j()}var t=!1,n=0,i=0;if(le()&&(t=!0,E(),!B()))throw D("Expected opening parentheses.");if(tt(!0))for(n++,e&&Bn.addVariable(e,Bn.context().getLast().getPattern());nt();){if(!tt())throw D("Expecting node pattern.");n++,i++}if(t&&(0==i||1<i))throw"Expected single relationship pattern.";if(t&&!L())throw D("Expected closing parentheses.");return t&&Bn.context().getPattern().shortestpath(),0<n},ct=function(){if(j(),fe()){if(j(),at())return c(),t(),!0;throw D("Expecting graph pattern.")}return!1},ht=function(){if(j(),ce()){do{if(j(),!at())throw D("Expecting graph pattern.")}while(S());return c(),t(),!0}return!1},ft=function(){if(j(),he()){do{if(j(),!at())throw D("Expecting graph pattern.")}while(S());return c(),t(),!0}return!1},c=function(){be()&&(h(),f.where(Ln.getExpression()))},t=function(){if(j(),Se()){f.setter();do{if(!d(!0))throw D("Expected variable.");var t=f.getVariable(E());if(I()){if(!At())throw D("Expected property key.");if(n=E(),j(),!en())throw D("Expected equals character (=).");j(),h();var e=Ln.getExpression();f.operationContext().addSetter(t,n,e)}else{var n=t.getObject().constructor;if(n!=pn&&n!=gn)throw"Can't assign a label/type to a \""+t.getObject().getType()+'".';if(A()){if(!h())throw"Expected expression.";e=Ln.getExpression();n==pn?f.operationContext().addLabelSetter(t,e):n==gn&&f.operationContext().addTypeSetter(t,e)}else if(nn()){if(!h())throw"Expected expression.";e=Ln.getExpression();n!=pn&&n!=gn||f.operationContext().addMapSetter(t,e)}}}while(S())}},lt=function(){we()&&(h(!0),f.limit(Ln.getExpression()))},h=function(t){var e,n,i=!0;if(n=it())i=!1;else if(B()){if(se(),n=h(t),!L())throw D("Expected closing parentheses.");ae()}else if(e=xt())n=ne(e),i=!1;else if(de())n=bt();else if(pe())n=wt();else if(Lt())n=Jt(E());else if(e=gt())ee(e),i=!1;else if(e=Bt())ie(e);else if(d(!0)){if(t)throw D("Variables not allowed within this context.");n=Xt(E())}else if(e=yt())n=$t(e);else if(e=vt())n=te(e);else if(!K())throw D("Expected expression");return n&&i&&dt(n),j(),Fe()&&(ue(On.latestParsed),j(),h()),n},l=function(){Ln.addLayer(),h();var t=Ln.getExpression();return Ln.finishLayer(),t},dt=function(t){for(;;)if(I()){if(!At())throw D("Expected property key.");Ut(t,E())}else if(!pt(t)){zt();break}},pt=function(t){if(cn()){if(qt(t,l()),hn())return!0;throw D("Expected closing square bracket.")}return!1},gt=function(){if(De()){j();for(var t=new bn;Ce();){if(t.when(l()),j(),!Me())throw D("Expected THEN keyword");t.then(l()),j()}if(0==t.whenCount())throw D("Expected WHEN keyword");if(j(),ke()&&t.else(l()),j(),Ke())return t;throw D("Expected END keyword")}return!1},vt=function(){if(on()){var t=new yn;do{if(At()){var e=E();if(!A())throw D("Expected colon.");t.addEntry(e,l())}}while(S());if(un())return t;throw D("Expected closing curly bracket.")}return!1},yt=function(){if(cn()){for(var t=new wn;k(),t.add(l()),S(););if(hn())return t;throw D("Expected closing bracket.")}return!1},wt=function(){if(G())throw D("Not allowed to nest aggregation functions.");if(B()){var t=oe(In.latestParsed);if(se(),F(),j(),Be()&&t.setDistinct(),j(),In.latestParsed.parametric()){for(var e=0;mt(),e++,S(););try{t.verifyParsedParameterCount(e)}catch(t){throw D(t)}}if(L())return ae(),_(),t;throw D("Expected closing parentheses.")}throw D("Expected opening parentheses.")},bt=function(){if(B()){var t=re(Pn.latestParsed);if(se(),Pn.latestParsed.parametric()){for(var e=0;mt(),e++,S(););try{t.verifyParsedParameterCount(e)}catch(t){throw D(t)}}if(L())return ae(),t;throw D("Expected closing parentheses.")}throw D("Expected opening parentheses.")},mt=function(){Zt(l())},xt=function(){var t=r;if(0<(charsToAccumulate=Tn.isPredicateFunction(i,r))&&(r+=charsToAccumulate,B(!1,!0))){var e=new mn;if(e.setPredicateFunctionName(Tn.latestParsed.displayValue()),j(),d(!0)){var n=E();if(e.variable(n),j(),Ge()){j();n=l();if(!n)throw D("Expected list.");if(e.list(n),j(),!be())throw D("Expected WHERE-keyword.");j();n=l();if(e.where(n),j(),L())return e;throw D("Expected closing parentheses.")}}}return r=t,!1},d=function(t){t=!t;if(j(),Ye(V()))return!1;if(T())for(;N()&&!T();)o+=V(),r++;else if(!T())for(;N()&&!n[V()];)o+=V(),r++;return!!(0<o.length&&ze())&&(t&&f.variable(E()),!0)},Rt=function(){return d(!0)},Et=function(){return d(!1)},Nt=function(){return d(!1)},Ot=function(){return d(!0)},Pt=function(){if(j(),!A())return!1;var t="";if(T())for(;N()&&!T();)t+=V(),r++;else if(!T())for(;N()&&!n[V()];)t+=V(),r++;if(""==t)throw D("Expecting label name.");return f.label(t),Pt(),!0},It=function(){if(j(),!A())return!1;var t="";if(T())for(;N()&&!T();)t+=V(),r++;else if(!T())for(;N()&&!n[V()];)t+=V(),r++;if(""==t)throw D("Expecting type name.");return f.type(t),!0},p=function(){if(j(),on()){if(!Tt())throw D("Expecting at least one property.");if(un())return!0;throw D("Expecting closing curly brackets.")}return!1},Tt=function(){if(!At())return!1;if(f.propertyKey(E()),A())return f.propertyValue(l()),!S()||Tt();throw D("Expected colon.")},At=function(){if(j(),Ye(V()))return!1;if(T())for(;N()&&!T();)o+=V(),r++;else if(!T())for(;N()&&!n[V()];)o+=V(),r++;return 0!=o.length},St=function(){var t=null;if($e())t=$e;else if(tn())t=tn;else{if(!T())return!1;t=T}for(u=!0;!t();){if(!N())throw D("Expected closing quote.");rn(),o+=V(),r++}return!(u=!1)},Bt=function(){if("f"!=V())return!1;r++;var t=null;if($e())t=$e;else if(tn())t=tn;else{if(!T())return r--,!1;t=T}var e=new xn;for(u=!0;!t();){if(!N())throw D("Expected closing quote.");if(rn(),sn()){for(o+="{";N()&&!an();)rn(),o+=V(),r++;if(!N())throw D("Expected closing double curly bracket.");o+="}"}if(on(!0)){var n=E(),i=l();if(!i)throw D("Expected expression.");if(!un(!0))throw D("Expected closing curly bracket.");0<n.length&&e.string(n),e.expression(i)}if(t())break;o+=V(),r++}return u=!1,0<o.length&&e.string(E()),e},Lt=function(){if(!St())if(_e())o=parseFloat(o);else if(Le())o=!0;else if(je())o=!1;else{if(!Ve())return!1;o=null}return!0},jt=function(){if(j(),Te()){if(Rt())return f.as(E()),!0;throw D("Expected alias variable key.")}return!1},Vt=function(){if(j(),Te()){if(Et())return f.as(E()),!0;throw D("Expected alias variable key.")}return!1},Dt=function(){if(j(),Te()){if(Nt())return!0;throw D("Unwinded collection must be aliased.")}return!1};function Ct(t,e){function n(){if(o.parent&&o.parent.getLocalVariable){var t=o.parent.getLocalVariable(r);if(t)return t}return i.statement().getVariable(r)}var i=t,r=e,o=this;this.getObject=function(){return n().getObject()},this.value=function(t){return n().value(t)},this.getKey=function(){return r},this.type=function(){return n().getObject().type()},this.groupByKey=function(){var t=n().getObject();return t.groupByKey&&t.groupByKey()||t},this.groupByValue=function(){var t=n().getObject();return t.groupByValue&&t.groupByValue()||t}}function g(t){var e=t,n=0,i=void 0,r=void 0,o=this,u=this,s=0,a=void 0,c=(e.parent=o,this.element=function(){return e},this.precalculate=function(){n=0,i=this.value(),r=this.value,h(c)},function(){var t;return i&&0==n?(n++,i):i&&1==n?(t=i,i=void 0,n=0,h(r),t):void 0}),h=function(t){o.value=t,o.groupByKey=o.value,o.groupByValue=o.value};this.elementValueContext=function(){return u},this.elementValue=function(){return e.value.call(u)},this.type=e.type,this.value=this.elementValue,this.groupByKey=e.groupByKey||this.elementValue,this.groupByValue=e.groupByValue||this.elementValue,this.hasKey=function(){return e.getKey&&e.getKey()},this.parsedParameterCount=function(){return s},this.verifyParsedParameterCount=function(t){e.constructor!=Pn&&e.constructor!=In||(s=t,e.verifyParsedParameterCount(s))},this.non_deterministic=function(){return e.non_deterministic()},this.mappable=function(){if(e.mappable&&!e.mappable())return!1;if(this.p)for(var t=0;t<this.p.length;t++)if(this.p[t].mappable&&!this.p[t].mappable())return!1;return!0},this.setExpression=function(t){a=t},this.getLocalVariable=function(t){if(a)return a.getLocalVariable(t)}}function Mt(t){g.call(this,t);var e,n,i=!1;this.setReducer=function(t){n=t},this.setGroupBy=function(t){e=t},this.getGroupBy=function(){return e},this.getReducerId=function(){return n},this.initializeIfNecessary=function(){this.initialize()},this.initialize=function(){return this.element().initialize.call(this.elementValueContext())},this.aggregate=function(){return this.element().aggregate.call(this.elementValueContext())},this.value=function(){return this.element().value.call(this.elementValueContext())},this.groupByKey=function(){return this.element().groupByKey.call(this.elementValueContext())},this.groupByValue=function(){return this.element().groupByValue.call(this.elementValueContext())},this.hasKey=function(){return this.element().getKey&&this.element().getKey()},this.distinct=function(){return i},this.setDistinct=function(){i=!0},this.mappable=function(){return!1}}(Mt.prototype=Object.create(g.prototype)).constructor=Mt;var kt=[],v=[],y=[],w=[],b=function(t){return w.push(t),t},Kt=function(){v=[],y=[],w=[]},Gt=function(){return 0==v.length?null:v[v.length-1]},Ft=function(){return 0==y.length?null:y[y.length-1]},m=(this.addLayer=function(){kt.push({output:v,operators:y,expressionElements:w,rollbackPosition:e}),Kt()},this.finishLayer=function(){var t=kt.pop();v=t.output,y=t.operators,w=t.expressionElements,e=t.rollbackPosition},function(t){return v.push(t),Gt()}),_t=function(t){return y.push(t),Ft()},Ht=function(t,e){return!!(t.leftAssociativity()&&t.precedence()<=e.precedence())||!!(t.rightAssociativity()&&t.precedence()<e.precedence())},Ut=function(t,e){t.lookups||(t.lookups=[]),t.lookups.push({function:Pn.f.object_lookup,index:b(new g(new Rn(e)))})},qt=function(t,e){t.lookups||(t.lookups=[]),t.lookups.push({function:Pn.f.array_lookup,index:b(new g(e))})},zt=function(){},Jt=function(t){return m({isAtom:!0,v:b(new g(new Rn(t)))}).v},Wt=function(){for(var t=f.statement().context().variables(),e=0;e<t.length;e++)Xt(t[e].getObjectKey()),f.expression()},Xt=function(t){return m({isAtom:!0,isVariable:!0,v:b(new g(new Ct(f,t)))}).v},Qt=function(t){return m({isAtom:!0,v:b(new g(t))}).v},Yt=function(){Gt().v.element().constructor==vn&&v.pop()},Zt=function(t){return m({isAtom:!0,v:b(new g(t))}).v},$t=function(t){return m({isAtom:!0,v:b(new g(t))}).v},te=function(t){return m({isAtom:!0,v:b(new g(t))}).v},ee=function(t){return m({isAtom:!0,v:b(new g(t))}).v},ne=function(t){return m({isAtom:!0,v:b(new g(t))}).v},ie=function(t){return m({isAtom:!0,v:b(new g(t))}).v},re=function(t){return _t({isFunction:!0,v:b(new g(t))}).v},oe=function(t){return _t({isAggregateFunction:!0,isFunction:!0,v:b(new Mt(t))}).v},ue=function(t){for(;0<y.length&&(y.slice(-1)[0].isOperator||y.slice(-1)[0].isFunction)&&Ht(t,y.slice(-1)[0].v.element());)v.push(y.pop());return _t({isOperator:!0,v:b(new g(t))}).v},se=function(){_t({leftParentheses:!0})},ae=function(){for(;0<y.length&&!y.slice(-1)[0].leftParentheses;)v.push(y.pop());y.pop()},ce=(this.getExpression=function(){for(;0<y.length;)v.push(y.pop());for(var t,e,n=An([]),i=[],r=!1;0<v.length;){if((e=v.shift()).isOperator)e.v.rhs=n.pop().v,e.v.lhs=n.pop().v;else if(e.isFunction){e.v.p=[];for(var o=0;o<e.v.parsedParameterCount();o++)e.v.p.unshift(n.pop().v);e.isAggregateFunction&&(t=t||[],e.v.p=e.v.p,t.push(e.v)),e.v.element().non_deterministic&&(r=!0)}if(e.isVariable&&i.push(e.v.element().getKey()),e.v.lookups)for(var u,s,a=e.v.lookups;a&&0<a.length;)s=e.v,u=a.shift(),e.v=new g(u.function),e.v.p=[s,u.index];n.push(e)}if(0==n.length)return null;for(var c=new jn(n.pop().v,"expr",t,f.statement().context(),i,r),h=0;h<w.length;h++)w[h].setExpression(c);return Kt(),c},function(){return x(Nn.f.CREATE)}),he=function(){return x(Nn.f.MATCH)},fe=function(){return x(Nn.f.MERGE)},le=function(){return x(Nn.f.SHORTESTPATH)},de=function(){var t;return 0<(t=Pn.isFunction(i,r))&&(r+=t,!!B(!0,!0)||(r-=t,!1))},pe=function(){var t;return 0<(t=In.isAggregateFunction(i,r))&&(r+=t,!0)},ge=function(t){return x(Nn.f.WITH,t)},ve=function(){return x(Nn.f.RETURN)},ye=function(){return x(Nn.f.INTO)},we=function(){return x(Nn.f.LIMIT)},ve=function(){return x(Nn.f.RETURN)},be=function(){return x(Nn.f.WHERE)},me=function(){return x(Nn.f.LOAD)},xe=function(){return x(Nn.f.UNWIND)},Re=function(){return x(Nn.f.CSV)},Ee=function(){return x(Nn.f.JSON)},Ne=function(){return x(Nn.f.TEXT)},Oe=function(){return x(Nn.f.HEADERS)},Pe=function(){return x(Nn.f.FROM)},Ie=function(){return x(Nn.f.POST)},Te=function(){return x(Nn.f.AS)},Ae=function(){return x(Nn.f.FIELDTERMINATOR)},Se=function(){return x(Nn.f.SET)},Be=function(){return x(Nn.f.DISTINCT)},Le=function(){return x(Nn.f.TRUE)},je=function(){return x(Nn.f.FALSE)},Ve=function(){return x(Nn.f.NULL)},De=function(){return x(Nn.f.CASE)},Ce=function(){return x(Nn.f.WHEN)},Me=function(){return x(Nn.f.THEN)},ke=function(){return x(Nn.f.ELSE)},Ke=function(){return x(Nn.f.END)},Ge=function(){return x(Nn.f.IN)},Fe=function(){var t;return 0<(t=On.isOperator(i,r))&&(r+=t,!0)},x=function(t,e){var n;return 0<(n=Nn.isKeyWord(i,r))&&Nn.latestParsed===t&&(e||Nn.latestParsed.action(f),r+=n,!0)},_e=function(){j();var t=!1;if(Qe()&&(R(),t=!0),!P()){if(t)throw D("Expected number.");return!1}for(R();P();)R();if(I()){if(R(),!P())throw D("Expected one or more integers after decimal point.");for(R();P();)R()}return j(),!0},He=function(){if(j(),!P())return!1;for(R();P();)R();return j(),!0},R=function(){o+=fn()},Ue=function(){e=r},qe=function(){null==e||r<e||(r-=r-e,o="",e=void 0)},ze=function(){return!(Pn.isFunction(o,0)&&B(!0)||In.isAggregateFunction(o,0)&&B(!0)||Nn.isKeyWord(o,0))||(r-=o.length,!1)},E=function(){var t=o;return o="",t},N=function(){return r<i.length},O=function(t,e,n){n=!n;return e||j(),V()==t&&(n&&r++,!0)},Je=function(){return O("<")},We=function(){return O(">")},Xe=function(){return O("-")},Qe=function(){return O("-")},Ye=function(t){return!isNaN(parseInt(t))},P=function(){var t=Ye(V());return t&&r++,t},Ze=function(){return O("*")},I=function(){return O(".")},$e=function(){return("\\"!=fn()||"'"!=V()||!u)&&O("'",!0)},tn=function(){return("\\"!=fn()||'"'!=V()||!u)&&O('"',!0)},T=function(){return("\\"!=fn()||"`"!=V()||!u)&&O("`",!0)},A=function(){return O(":")},en=function(){return O("=")},nn=function(){return O("+")&&O("=")},S=function(){return O(",")},rn=function(){return O("\\",!0)},B=function(t,e){return O("(",e,t)},L=function(){return O(")")},on=function(t,e){return O("{",t,e)},un=function(t,e){return O("}",t,e)},sn=function(){var t="{"==V()&&"{"==ln();return t&&(r+=2),t},an=function(){var t="}"==V()&&"}"==ln();return t&&(r+=2),t},cn=function(){return O("[")},hn=function(){return O("]")},j=function(){if(N()){for(;" "==V()||"\n"==V()||"\t"==V()||"\r"==V();)r++;if("/"==V()&&"/"==ln()){for(;"\n"!=V()&&N();)r++;j()}}},fn=function(){return i.charAt(r-1)},V=function(){return i.charAt(r)},ln=function(){return i.charAt(r+1)},dn=function(){return' Parsed "'+i.substring(0,r)+'". Got "'+V()+'"'},D=function(t){return Kt(),t+dn()}}}{function s(t){var e=t;try{for(;e;)console.log(e),e=e.caller}catch(t){}}function An(i){return i.contains=function(t){for(var e=0;e<i.length;e++)if(t==i[e])return!0;return!1},i.toLowerCase=function(){for(var t=[],e=0;e<i.length;e++)t.push(i[e].toLowerCase&&i[e].toLowerCase()||i[e]);return t},i.toUpperCase=function(){for(var t=[],e=0;e<i.length;e++)t.push(i[e].toUpperCase&&i[e].toUpperCase()||i[e]);return t},i.get=function(){return i},i.last=function(){return i[i.length-1]},i.beforeLast=function(){return i[i.length-2]},i.value=function(){return i},i.join=function(t){for(var e="",n=0;n<i.length;n++)e+=(0<n?t:"")+i[n];return e},i.trim=function(){for(var t=new Array(i.length),e=0;e<i.length;e++)t[e]=i[e].trim();return t},i}function I(e){return e.getProperty||(e.getProperty=function(t){return e[t]}),e.getProperties||(e.getProperties=function(){return e}),e.getKeys||(e.getKeys=function(){var t=[];for(key in e)e[key].constructor!==Function&&t.push(key);return t}),e}function g(t){if(t&&t.constructor==String)return t.replace(/\0/g,"");if(t&&(t.constructor==X||t.constructor==Q))return g(t.value());if(t){for(var e in t)"function"==typeof t[e]?delete t[e]:t[e]&&(t[e]=g(t[e]));t.fromNode&&(t.fromNode=g(t.fromNode)),t.toNode&&(t.toNode=g(t.toNode))}return t}function X(t,e){var n=t,i=e;this.nodeId=function(){return i},this.id=this.nodeId,this.getNode=function(){return n.getNodeById(i)},this.getObject=function(){return n.getNodeById(i)},this.value=function(){return n.getNodeById(i).toObject()},this.getData=this.value,this.getProperty=function(t){return n.getNodeById(i).getLocalProperty(t)},this.getProperties=function(){return this.value().getProperties()},this.getLabels=function(){return this.value().getLabels()},this.getKeys=function(){return this.value().getProperties().getKeys()},this.groupByKey=this.nodeId}function Q(t,e){var n=t,i=e;this.relationshipId=function(){return i},this.id=this.relationshipId,this.getRelationship=function(){return n.getRelationshipById(i)},this.getObject=function(){return n.getRelationshipById(i)},this.value=function(){return n.getRelationshipById(i).toObject()},this.startNode=function(){return this.getRelationship().getFromNode().get()},this.endNode=function(){return this.getRelationship().getToNode().get()},this.getData=this.value,this.getProperty=function(t){return n.getRelationshipById(i).getLocalProperty(t)},this.getProperties=function(){return this.value().getProperties()},this.getKeys=function(){return this.value().getProperties().getKeys()},this.getType=function(){return this.value().getType()},this.groupByKey=this.relationshipId}}var r,Sn=new t(this),Bn=new h(this),Ln=new m(this);this.execute=function(t,e,o){Bn.clear();var u=arguments.callee;try{self.onerror=function(t,e,n,i,r){console.log(t),o(t),s(u)}}catch(t){}try{Ln.parse(t),Bn.setSuccessCallback(e),this.run()}catch(t){o(t),s(u);try{console.log(t)}catch(t){}}},this.addGraph=function(t,e){for(var n=0;n<t.length;n++)Sn.addNode(t[n]);for(n=0;n<e.length;n++)Sn.addRelationship(e[n])},this.resetDataBase=function(){Sn=new t(this)},this.setDataDownloadProxy=function(t){r=t},this.getDataDownloadProxy=function(){return r},this.db=function(){return Sn},this.optional=function(){return this},this.create=function(){return Bn.addOperation(new v(Bn)),this},this.match=function(){return Bn.addOperation(new y(Bn)),this},this.pattern=function(){return Bn.context().addPattern(),this},this.node=function(){return Bn.context().addNode(new pn(Sn)),this},this.relationship=function(){return Bn.context().addRelationship(new gn(Sn)),this},this.expression=function(){return Bn.context().expression(Ln.getExpression()),this},this.variable=function(t){return Bn.context().variable(t),this},this.variableExists=function(t){return Bn.hasVariable(t)},this.getVariable=function(t){return Bn.getVariable(t)},this.lastObject=function(){return Bn.context().getLast()},this.label=function(t){return Bn.context().getLast().setLabel(t),this},this.type=function(t){return Bn.context().getLast().setType(t),this},this.readProperty=function(t){return Bn.context().getLast().readProperty(t),this},this.propertyValue=function(t){return Bn.context().getLast().setProperty(Bn.getPropertyKey(),t),this},this.propertyKey=function(t){return Bn.setPropertyKey(t),this},this.as=function(t){return Bn.context().getLast().setAlias(t),this},this.leftDirection=function(){return Bn.context().getLast().setLeftDirection(!0),this},this.setter=function(){return Bn.addOperation(new l),this},this.relStart=function(){return this},this.relMiddle=function(){return this},this.relEnd=function(){return this},this.rightDirection=function(){return Bn.context().getLast().setRightDirection(!0),this},this.variableProperty=function(t){return this},this.equals=function(){return this},this.constant=function(t){return Bn.context().constant(t),this},this.load=function(){return Bn.addOperation(new b(Bn)),this},this.csv=function(){return Bn.context().csv(),this},this.json=function(){return Bn.context().json(),this},this.text=function(){return Bn.context().text(),this},this.post=function(){return Bn.context().post(),this},this._with=function(){return Bn.addOperation(new w(Bn)),this},this._return=function(){return Bn.addOperation(new i(Bn)),this},this.into=function(){return this},this.insertInto=function(t){Bn.addOperation(new f(Bn.engine().db(),t))},this.merge=function(){return Bn.addOperation(new a(Bn)),this},this.unwind=function(){return Bn.addOperation(new En(Bn)),this},this.limit=function(t){return Bn.context().limit(t),this},this.where=function(t){return Bn.context().where(t),this},this.statement=function(){return Bn},this.operation=function(){return Bn.context().type()},this.context=function(){return Bn.context().getLast()},this.operationContext=function(){return Bn.context()},this.run=function(){switch(Bn.context().type()){case"Match":case"With":throw"A "+Bn.context().type()+"-statement cannot conclude the query."}Bn.operations()[0].run()}}var Cypher_context_is_worker=null==this.document,isStandaloneJSEngine=!1,Cypher_script_path=function(){var t;return Cypher_context_is_worker?"":(t=this.document.getElementsByTagName("script"))[t.length-1].src}();try{module&&(isStandaloneJSEngine=!0)}catch(t){isStandaloneJSEngine=!1}function Cypher(t){var r,o,u,e=!t||!t.runInWebWorker;if(Cypher_context_is_worker&&!isStandaloneJSEngine)try{var i=new CypherJS;t&&t.dataDownloadProxy&&i.setDataDownloadProxy(t.dataDownloadProxy),self.onmessage=function(t){var e=t.data,n=e.action;switch(n){case"query":return void i.execute(e.statementText,function(t){self.postMessage({action:n,success:!0,results:t})},function(t){self.postMessage({action:n,error:!0,message:t})});case"addGraph":try{i.addGraph(e.nodes,e.edges)}catch(t){return void self.postMessage({action:n,error:!0,message:t})}return void self.postMessage({action:n,success:!0});case"resetDataBase":return i.resetDataBase(),void self.postMessage({action:n})}}}catch(t){}else Cypher_context_is_worker||e||isStandaloneJSEngine?(isStandaloneJSEngine||!isStandaloneJSEngine&&!Cypher_context_is_worker&&e)&&(i=new CypherJS,t&&t.dataDownloadProxy&&i.setDataDownloadProxy(t.dataDownloadProxy),this.execute=function(t,e,n){i.execute(t,e,n)}):((u=new Worker(Cypher_script_path)).onmessage=function(t){var e=t.data;switch(e.action){case"query":case"addGraph":return void(e.success?r(e.results):e.error&&o(e.message));case"resetDataBase":return void(r&&r())}},this.execute=function(t,e,n){r=e,o=n,u.postMessage({action:"query",statementText:t})},this.addGraph=function(t,e,n,i){r=n,o=i,u.postMessage({action:"addGraph",nodes:t,edges:e})},this.resetDataBase=function(t){r=t?_successCallback:function(){},u.postMessage({action:"resetDataBase"})})}Object.values||(Object.values=function(t){var e,n=[];for(e in t)n.push(t[e]);return n}),Object.keys||(Object.keys=function(t){var e,n=[];for(e in t)n.push(e);return n}),Array.prototype.fill||(Array.prototype.fill=function(t){for(var e=Object(this),n=0;n<e.length;n++)e[n]=t;return e}),Array.prototype.concat||(Array.prototype.concat=function(t){for(var e=Object(this),n=new Array(e.length+t.length),i=0;i<e.length;i++)n[i]=e[i];for(;i<n.length;i++)n[i]=t[i-e.length];return n}),Number.MAX_SAFE_INTEGER||(Number.MAX_SAFE_INTEGER=9007199254740991),Cypher_context_is_worker&&new Cypher;try{module.exports={Cypher:Cypher}}catch(t){}
