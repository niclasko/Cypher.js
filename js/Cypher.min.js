// https://github.com/niclasko/Cypher.js Copyright 2022 Niclas Kjall-Ohlsson.
function CypherJS(){{function StringRecoder(){function o(){return[{},null]}var u=o(),s=1;this.recode=function(t){if(!t)return t;var e=t;e.charAt||(e=""+t);for(var n,i=u,r=0;r<e.length;r++)n=e.charAt(r),i[0][n]||(i[0][n]=o()),i=i[0][n];return i[1]||(i[1]=s++)}}function IDFactory(){var t=-1;this.getId=function(){return t++}}function DB(i){var o=this,s=[],t=0,r={},n={},c=[],e=0,u={},a={},h={},f={},l={},d={},p=new StringRecoder,g=function(t){return p.recode(t)},y=function(t,e){null!=t&&(u[t]||(u[t]={}),null!=e&&(u[t][e]||(u[t][e]=[])))},v=function(t,e){if(y(t,e),null!=t){if(null!=e)return u[t][e];if(null==e){var n=[];for(nodeId in u[t])n=n.concat(u[t][nodeId]);return n}}return[]},b=function(t,e,n){y(t,e),u[t][e].push(n),R(t,n),O(e,n)},w=function(t){a[t]||(a[t]=[])},m=function(t){return w(t),a[t]},R=function(t,e){w(t),a[t].push(e)},x=function(t){h[t]||(h[t]=[])},N=function(t){return x(t),h[t]},O=function(t,e){x(t),h[t].push(e)},E=function(t,e){r[t]||(r[t]={}),r[t][e]||(r[t][e]=[])},A=function(t,e){t=g(t),e=g(e);return E(t,e),r[t][e]},P=function(t,e){f[t]||(f[t]={}),f[t][e]||(f[t][e]=[])},I=function(t,e,n){t=g(t),e=g(e);E(t,e),r[t][e].push(n)},F=function(t,e,n){t=g(t),e=g(e);P(t,e),f[t][e].push(n)},T=function(t){n[t]||(n[t]=[])},S=function(t){t=g(t);return T(t),n[t]},K=function(t){if(!l[t])return!(l[t]=[])},_=function(t,e){t=g(t);T(t);null==e||n[t].find(function(t){return t==e})||n[t].push(e)};this._addLabelNodeIdLookup=function(t,e){_(t,e)};var B=function(t,e){var n;null!=e&&(n=g(t),K(n),l[n].find(function(t){return t==e})||(l[n].push(e),c[e].setStoredType(t)))};this._addTypeRelationshipIdLookup=function(t,e){B(t,e)};function C(t,e){if(e){if(e,s[e])throw"Node with ID "+e+" already exists in the database.";t.setId(e),s[e]=t}else t.setId(V()),s[t.id()]=t;for(key in t.getRawProperties())I(key,t.getLocalProperty(key),t.id());for(label in t.labels())_(label,t.id());i.statement().setNodesAdded(i.statement().getNodesAdded()+1)}function L(t,e){var n=null;if(e){if(e,s[e])throw"Relationship with ID "+e+" already exists in the database.";n=e}else n=D();for(key in t.setId(n),c[n]=t,b(t.getFromNode().id(),t.getToNode().id(),t.id()),t.getToNode().id()!=t.getFromNode().id()&&b(t.getToNode().id(),t.getFromNode().id(),t.id()),t.getProperties())F(key,t.getProperty(key),t.id());B(t.getType(),t.id()),t.setIsAdded(),i.statement().setRelationshipsAdded(i.statement().getRelationshipsAdded()+1)}var V=function(){for(;s[t];)t++;return t},D=function(){for(;c[e];)e++;return e},j=function(t,e,n){var i,r=[];if(t.isReferred()){if(t.isReferred()){var o=t.getReferredRelationship().getData();if(!o)throw"Expected relationship.";if(o.constructor!=Relationship&&o.constructor!=RelationshipReference)throw"Expected relationship.";r.push(o.id())}}else e&&n?(i=v(e.id(),n.id()),r=r.concat(i)):e&&!n&&(i=m(e.id()),t.uniDirectional()&&i.concat(N(e.id())),r=r.concat(i));if(0==r.length)return!1;var u=new W;for(key in u.setMatchingSet(r,0),(t.leftDirection()||t.rightDirection())&&u.incrementToMatchCount(),t.getType()&&u.incrementToMatchCount(),t.getProperties())u.incrementToMatchCount();if(0<u.toMatchCount()){for(var s,a=0;a<r.length;a++)for(key in s=c[r[a]],(t.leftDirection()||t.rightDirection())&&(t.leftDirection()!=s.leftDirection(e.id())&&t.rightDirection()!=s.rightDirection(e.id())||u.keepMatchTally(r[a])),t.getType()&&s.getType()&&s.getType()==t.getType()&&u.keepMatchTally(r[a]),t.getProperties())t.getLocalProperty(key)==s.getLocalProperty(key)&&u.keepMatchTally(r[a]);u.updateMatchingSet()}return 0!=u.matchingSetSize()&&u.matchingSet()};function W(){var r=0,o=[],u=[];this.setMatchingSet=function(t,e){u=t,o=new Array(u.length).fill(null!=e?e:1)},this.addToMatchingSet=function(t){u.push(parseInt(t)),o.push(0)},this.updateMatchingSet=function(){for(var t=0,e=0;e<u.length;e++)o[e]==r&&t++;for(var n=new Array(t),i=0,e=0;e<u.length;e++)o[e]==r&&(n[i++]=u[e]);u=n,o=new Array(u.length).fill(r)},this.incrementToMatchCount=function(){r++},this.keepMatchTally=function(t){for(var e=0;e<u.length;e++)u[e]==t&&(o[e]=o[e]+1||1)},this.toMatchCount=function(){return r},this.matchingSet=function(){return u},this.matchingSetSize=function(){return u.length}}this.createNode=function(t){var e;t.isReferred()?e=t.getReferredNode().getData():(t.bindProperties(),e=t.copy(),C(e),t.addMatchedNode(e)),t.outgoingRelationship()&&t.outgoingRelationship().setFromNode(e),t.incomingRelationship()&&(t.incomingRelationship().bindProperties(),t.incomingRelationship().setToNode(e),e=t.incomingRelationship().copy(),L(e),t.incomingRelationship().addMatchedRelationship(e)),t.nextNode()?t.nextNode().create():t.nextNode()||t.nextAction()};var M=function(t,e){var n;for(key in t.getProperties()){if(t.bindProperty(key),0==e.toMatchCount()&&0==e.matchingSetSize())(n=A(key,t.getLocalProperty(key)))&&e.setMatchingSet(n);else if(0<e.matchingSetSize())for(var i=0;i<e.matchingSetSize();i++)t.getLocalProperty(key)==s[e.matchingSet()[i]].getLocalProperty(key)&&e.keepMatchTally(e.matchingSet()[i]);e.incrementToMatchCount(),e.updateMatchingSet()}},k=function(t,e){var n;for(label in t.labels()){if(0==e.toMatchCount()&&0==e.matchingSetSize())(n=S(label))&&e.setMatchingSet(n);else if(0<e.matchingSetSize())for(var i=0;i<e.matchingSetSize();i++)s[e.matchingSet()[i]].hasLabel(label)&&e.keepMatchTally(e.matchingSet()[i]);e.incrementToMatchCount(),e.updateMatchingSet()}},G=function(t,e,n){if(t.nextNode()){if(t.getPattern().usedAsCondition())return t.nextNode().convey(e,n);t.nextNode().convey(e,n)}else if(!t.nextNode()){if(t.getPattern().usedAsCondition())return t.nextAction();t.nextAction()}},H=function(t){var e=[];if(0<t.matchingSetSize())e=t.matchingSet();else if(0==t.toMatchCount())for(var e=new Array(s.length),n=0;n<s.length;n++)e[n]=s[n].id();return e},U=function(t,e,n,i){!i&&t.outgoingRelationship().expandPath()&&0<e&&t.outgoingRelationship().resetExpandedPath(),t.isExpanded()||(t.addMatchedNode(s[n]),t.outgoingRelationship().setFromNode(s[n]));e=null;return t.outgoingRelationship().getNextObject().isReferred()&&!t.outgoingRelationship().hasVariablePathLength()&&(e=t.outgoingRelationship().getNextObject().getReferredNode().getData()),t.outgoingRelationship().bindProperties(),j(t.outgoingRelationship(),s[n],e)},z=function(t,e,n,i,r){for(var o,u=0;u<r.length;u++)if(o=c[[r[u]]],t.outgoingRelationship().pathLengthSatisfied()){if(t.outgoingRelationship().setExpandedEndNode(o.getToNode(e)),t.outgoingRelationship().setMatchedRelationship(o),t.getPattern().usedAsCondition()){if(null!=(o=G(t,n,i)))return o}else G(t,n,i);t.outgoingRelationship().setExpandedEndNode(null)}},J=function(t,e,n,i){if(t.outgoingRelationship().expandPath())for(var r=0;r<i.length;r++)relationship=c[[i[r]]],t.outgoingRelationship().addMatchedRelationship(relationship,{fromNodeId:e,toNodeId:relationship.getToNode(e).id()}),t.outgoingRelationship().visitedBefore(relationship.getToNode(e).id())?t.outgoingRelationship().backTrackExpandedPath():(t.outgoingRelationship().pathLengthSatisfied()&&(t.setExpandedNode(relationship.getToNode(e)),o.matchNode(t,!1,(n||0)+1),t.setExpandedNode(null)),t.outgoingRelationship().expandPath()&&!n&&t.outgoingRelationship().backTrackExpandedPath())};this.matchNode=function(t,e,n){var i=function(t,e){var n=[];if(t.isExpanded())t.isExpanded()&&(n=[t.getExpandedNode().id()]);else{var i=new W;if(t.isReferred()){var r=t.getReferredNode().getData();if(!r)throw"Expected node.";if(r.constructor!=Node&&r.constructor!=NodeReference)throw"Expected node.";i.addToMatchingSet(r.id())}if(t.incomingRelationship()&&t.incomingRelationship().hasExpandedEndNode()&&!t.isReferred()&&i.addToMatchingSet(t.incomingRelationship().getExpandedEndNode().id()),M(t,i),k(t,i),0==(n=H(i)).length&&e)return!t.getPattern().usedAsCondition()&&void t.getPattern().create()}return n}(t,e);if(i&&i.length)for(var r=0;r<i.length;r++){var o,u=i[r];if(null!=(o=function(t,e,n,i){if(!t.incomingRelationship()&&!t.outgoingRelationship()){if(t.addMatchedNode(s[e]),t.getPattern().usedAsCondition())return G(t,n,i);G(t,n,i)}}(t,u,e,n)))return o;if(null!=(o=function(t,e,n,i,r){var o;if(t.outgoingRelationship()){e=U(t,e,n,r);if(!e&&i)t.getPattern().create(),o=-1;else if(0<e.length){if(null!=(o=z(t,n,i,r,e)))return o;if(null!=(o=J(t,n,r,e)))return o}}return o}(t,r,u,e,n)))return o;if(null!=(o=function(t,e,n,i){if(t.incomingRelationship()&&(t.addMatchedNode(s[e]),t.incomingRelationship().hasExpandedEndNode())){var e=!0;if(e=t.isReferred()&&t.getReferredNode().getData().id()!=t.incomingRelationship().getExpandedEndNode().id()?!1:e)if(t.getPattern().usedAsCondition()){if(null!=(e=G(t,n,i)))return e}else G(t,n,i)}}(t,u,e,n)))return o}if(t.getPattern().usedAsCondition())return!1},this.getNodeById=function(t){return s[t]},this.getRelationshipById=function(t){return c[t]},this.addNode=function(t){var e=new Node(this);e.setProperties(t.properties),e.setLabels(t.labels),C(e,t.id)},this.addRelationship=function(t){var e=new Relationship(db);e.setFromNode(this.getNodeById(t.from)),e.setToNode(this.getNodeById(t.to)),e.setProperties(t.properties),e.setType(t.type),L(e,t.id)},this.addTable=function(t){d[t.name()]=t},this.getTable=function(t){if(!(t in d))throw'Table "'+t+'" does not exist.';return d[t]}}function Node(t){var e,n,i,r,o,u=t,s={},a={},c={},h=null,f=null,l=this,d=!1;this.setPreviousObject=function(t){i=t},this.getPreviousObject=function(){return i},this.setNextObject=function(t){r=t},this.getNextObject=function(){return r},this.setPattern=function(t){o=t},this.getPattern=function(){return o},this.nextNode=function(){if(l.getNextObject()){if(l.getNextObject().isRelationship())return l.getNextObject().getNextObject();if(l.getNextObject().isNode())return l.getNextObject()}return null},this.previousNode=function(){if(l.getPreviousObject()){if(l.getPreviousObject().isRelationship())return l.getPreviousObject().getPreviousObject();if(l.getPreviousObject().isNode())return l.getPreviousObject()}return null},this.incomingRelationship=function(){return l.getPreviousObject()&&l.getPreviousObject().isRelationship()?l.getPreviousObject():null},this.outgoingRelationship=function(){return l.getNextObject()&&l.getNextObject().isRelationship()?l.getNextObject():null},this.setId=function(t){e=t},this.id=function(){return e},this.getId=this.id,this.setProperty=function(t,e){c[t]=null,a[t]=e.value},this.setProperties=function(t){for(var e in t)c[e]=t[e]},this.bindProperty=function(t){c[t]=a[t]()},this.bindProperties=function(){for(var t in c)this.bindProperty(t)},this.setLabel=function(t,e){s[t]=!0,u._addLabelNodeIdLookup(t,e)},this.hasLabel=function(t){return s[t]},this.setLabels=function(t){for(var e in t)s[e]=t[e]},this.setVariableKey=function(t){n=t},this.getVariableKey=function(){return n},this.hasVariableKey=function(){return null!=n},this.getProperties=function(){return Object.create(c)},this.getRawProperties=function(){return c},this.labels=function(){return s},this.getLabels=function(){return Object.keys(s)},this.hasLabels=function(){return 0<Object.keys(s).length},this.hasProperties=function(){return 0<Object.keys(c).length};function p(t){var e,n=this;for(e in t)this[e]=t[e];this.getId=function(){return n.id},this.getData=function(){return n},this.getObject=function(){return n},this.groupByKey=function(){return n.id},this.groupByValue=function(){return n}}var g;this.get=function(t){return t?e:new NodeReference(u,e)},this.toObject=function(){return new p({id:e,labels:this.getLabels(),properties:addAssociativeArrayFunctions(c),getProperty:function(){return c[key]},getProperties:function(){return this.properties},getLabels:function(){return this.labels},getKeys:function(){return this.properties.getKeys()}})},this.toString=function(){return JSON.stringify(this.get())},this.type=function(){return this.constructor.name},this.isRelationship=function(){return!1},this.isNode=function(){return!0},this.setReferredNode=function(t){h=t},this.isReferred=function(){return null!=h},this.getReferredNode=function(){return h},this.setExpandedIsMatched=function(){d=!0},this.expandedIsMatched=function(){return!!d&&!(d=!1)},this.setExpandedNode=function(t){f=t},this.isExpanded=function(){return null!=f},this.getExpandedNode=function(){return f},this.nextAction=function(){},this.setNextAction=function(t){this.nextAction=t},this.convey=function(t,e){return u.matchNode(l,t,e)},this.create=function(){return u.createNode(l)},this.merge=function(){return u.mergeNode(l)},this.match=function(){return u.matchNodes(l)};var y={};this.addMatchedNode=function(t){g=t.id()},this.getMatchedNode=function(){return this.getData()},this.addMatchedIncomingRelationshipId=function(t,e){y[t]||(y[t]=[]),y[t].push(e)},this.getMatchedIncomingRelationshipIds=function(t){if(!y[t])return null;var e=y[t];return y[t]=[],e},this.getData=function(){return u.getNodeById(g)},this.getLocalProperty=function(t){return c[t]||null},this.getProperty=function(t){return u.getNodeById(g)?u.getNodeById(g).getLocalProperty(t):null},this.groupByKey=function(){return this.getData().id()},this.groupByValue=function(){return this.getData().get()},this.copy=function(){var t=new Node(u);return t.setLabels(s),t.setProperties(c),t},this.mappable=function(){if(h&&h.mappable&&!h.mappable())return!1;for(var t in c)if(!a[t].mappable())return!1;return!0}}function Relationship(t){var e,n,i,r,o,u,s,a,c,h,f=t,l={},d={},p=!1,g=!1,y=1,v=1,b=null;this.setPreviousObject=function(t){a=t},this.getPreviousObject=function(){return a},this.setNextObject=function(t){c=t},this.getNextObject=function(){return c},this.setPattern=function(t){h=t},this.getPattern=function(){return h},this.setId=function(t){e=t},this.id=function(){return e},this.setStoredType=function(t){n=t},this.setType=function(t,e){n=t},this.getType=function(){return n},this.setProperty=function(t,e){l[t]=null,d[t]=e.value},this.bindProperty=function(t){l[t]=d[t]()},this.bindProperties=function(){for(var t in l)this.bindProperty(t)},this.setProperties=function(t){for(var e in t)l[e]=t[e]},this.getProperty=function(t){return l[t]},this.getProperties=function(){return l},this.getRelationshipProperties=function(){return l},this.setFromNode=function(t){i=t},this.setToNode=function(t){r=t},this.getFromNode=function(t){return null!=t&&t!=i.id()?r:i},this.getToNode=function(t){return null!=t&&t!=i.id()?i:r},this.setLeftDirection=function(t){o=t},this.setRightDirection=function(t){u=t},this.leftDirection=function(t){return null!=t&&t!=i.id()?!o&&u:o&&!u},this.rightDirection=function(t){return null!=t&&t!=i.id()?!u&&o:u&&!o},this.uniDirectional=function(){return u&&o||!o&&!u},this.noDirection=function(){return!o&&!u},this.direction=function(){var t=this.leftDirection(),e=this.rightDirection();return t&&!e?"left":!t&&e?"right":t&&e?"both":"none"},this.type=function(){return this.constructor.name},this.isRelationship=function(){return!0},this.isNode=function(){return!1},this.setReferredRelationship=function(t){b=t},this.isReferred=function(){return null!=b},this.getReferredRelationship=function(){return b},this.isAdded=function(){return p},this.setIsAdded=function(){p=!0},this.setHasVariablePathLength=function(){g=!0,v=y=null},this.hasVariablePathLength=function(){return g},this.setPathLengthFrom=function(t){y=t},this.pathLengthFrom=function(){return y},this.setPathLengthTo=function(t){v=t},this.pathLengthTo=function(){return v},this.expandPath=function(){return g};function w(t){for(var e in t)this[e]=t[e];this.getId=function(){return this.id},this.getData=function(){return this},this.getObject=function(){return this},this.groupByKey=function(){return this.id},this.groupByValue=function(){return this}}var m;this.get=function(){return new RelationshipReference(f,e)},this.toObject=function(){return new w({id:e,type:n,properties:addAssociativeArrayFunctions(l),fromNode:i?i.get():null,toNode:r?r.get():null,direction:this.direction(),getProperty:function(){return l[key]},getProperties:function(){return l},getKeys:function(){return l.getKeys()},getType:function(){return n}})},this.toString=function(){var t="none";return this.leftDirection()?t="left":this.rightDirection()&&(t="right"),"id: "+e+". type: "+n+". properties: "+JSON.stringify(l)+". fromNodeId: "+(i?i.id():null)+". toNodeId: "+(r?r.id():null)+". direction: "+t},this.value=function(){return this.get()},this.setVariableKey=function(t){s=t},this.getVariableKey=function(){return s},this.hasVariableKey=function(){return null!=s},this.nextAction=function(){},this.setNextAction=function(t){this.nextAction=t};var R,x=[],N=[],O={},E=null,A=function(t){O[t]=(O[t]||0)+1};this.visitedBefore=function(t){return 1<x.length&&x[x.length-1]==x[x.length-2]||2<=O[t]},this.setMatchedRelationship=function(t){m=t.id()},this.addMatchedRelationship=function(t,e){g?(x.push(t.id()),N.push(e),e=e,0==x.length&&A(e.fromNodeId),A(e.toNodeId)):this.setMatchedRelationship(t)},this.getMatchedRelationship=function(){return this.getData()},this.hasExpandedEndNode=function(){return null!=E},this.setExpandedEndNode=function(t){E=t},this.getExpandedEndNode=function(){return E},this.setMatchingRelationshipIds=function(t){R=t},this.getMatchingRelationshipIds=function(){var t=null;return R&&(t=R.slice()),R=null,t},this.expandedPathLastItem=function(){return x[x.length-1]},this.backTrackExpandedPath=function(){var t;0!=x.length&&(x.pop(),t=N.pop(),0==x.length?O={}:O[t.toNodeId]--)},this.resetExpandedPath=function(){x=[],N=[],O={}},this.pathLengthFromSatisfied=function(){return!this.expandPath()||null==y||y&&x.length>=y},this.pathLengthToSatisfied=function(){return!this.expandPath()||null==v||v&&x.length<=v},this.pathLengthSatisfied=function(){return this.pathLengthFromSatisfied()&&this.pathLengthToSatisfied()},this.getExpandedPath=function(){return x},this.setShortestPath=function(t){x=t},this.getData=function(){return g?new List(x,function(t){return f.getRelationshipById(t).value()}):f.getRelationshipById(m)},this.getLocalProperty=function(t){return l[t]||null},this.getProperty=function(t){return f.getRelationshipById(m)?f.getRelationshipById(m).getLocalProperty(t):null},this.groupByKey=function(){return this.getData().id()},this.groupByValue=function(){return this.getData().get()},this.copy=function(){var t=new Relationship(f);return t.setType(n),t.setProperties(l),t.setLeftDirection(o),t.setRightDirection(u),t.setFromNode(i),t.setToNode(r),t},this.mappable=function(){if(b&&b.mappable&&!b.mappable())return!1;for(var t in l)if(!d[t].mappable())return!1;return!0}}function Pattern(){function e(t){r.empty()||(r.lastObject().setNextObject(t),t.setPreviousObject(r.lastObject())),t.setPattern(r),n.push(t)}var t,n=[],i=[],u=[],r=this,o=!1,s=!1,a=Number.MAX_SAFE_INTEGER,c=function(){u[0].getExpandedPath().length<a&&(a=u[0].getExpandedPath().length,t=u[0].getExpandedPath().slice())};this.shortestpath=function(){s=!0},this.addNode=function(t){i.push(t),e(t)},this.addRelationship=function(t){u.push(t),e(t)},this.nodeCount=function(){return this.nodes.length},this.relationshipCount=function(){return this.relationships.length},this.getData=function(){for(var t,n=[],e=[],i=0;i<u.length;i++)if(u[i].hasVariablePathLength()){if(u[i].hasVariablePathLength())for(var r=u[i].getData().value(),o=0;o<r.length;o++)t=r[o].getRelationship(),n.push(t.getFromNode().get(),t.get(),t.getToNode().get()),e.push(t.id())}else t=u[i].getData().value().getRelationship(),n.push(t.getFromNode().get(),t.get(),t.getToNode().get()),e.push(t.id());return(n=addArrayFunctions(n)).getNodes=function(){for(var t=[],e=0;e<n.length;e+=3)0==e&&t.push(n[e]),t.push(n[e+2]);return addArrayFunctions(t)},n.getRelationships=function(){for(var t=[],e=0;e<n.length;e+=3)t.push(n[e+1]);return addArrayFunctions(t)},this.groupByKey=function(){return e},this.groupByValue=function(){return n},n},this.objects=function(){return n},this.getObject=function(t){return n[t]},this.lastObject=function(){return n[n.length-1]},this.getLast=this.lastObject,this.empty=function(){return 0==n.length},this.setNextAction=function(t){h=t};var h=function(){};this.finish=function(){s&&(u[0].setShortestPath(t),h())};function f(){r.lastObject().setNextAction(function(){(s?c:h)()})}this.useAsCondition=function(){o=!0,r.lastObject().setNextAction(function(){return!0})},this.usedAsCondition=function(){return o},this.value=function(){return i[0].convey(!1)},this.match=function(){f(),i[0].convey(!1)},this.merge=function(){f(),i[0].convey(!0)},this.create=function(){f(),i[0].create()},this.mappable=function(){for(var t=0;t<n.length;t++)if(!n[t].mappable())return!1;return!0}}function AssociativeArray(){function n(){for(var t in i)r[t]=i[t].value()}var i={},r={},o=[],t=this;this.addEntry=function(t,e){if(t in i)throw'Key "'+t+'" already exists in associative array.';i[t]=e,r[t]=null,o.push(t)},this.get=function(){n();var t,e={};for(t in r)e[t]=r[t],e[t]&&(e[t].constructor=r[t].constructor);return addAssociativeArrayFunctions(e)},this.getProperty=function(t){return n(),r[t]},this.getProperties=function(){return Object.keys(i)},this.getValues=function(){return Object.values(i)},this.setValue=function(t,e){i[o[t]]=e},this.next=function(){return!1},this.hasNext=function(){return!0},this.reset=function(){},this.getData=function(){return t},this.getObject=function(){return t},this.value=function(){return t.get()},this.type=function(){return t.constructor.name},this.toString=function(){return n(),JSON.stringify(r)},this.groupByKey=function(){return t.toString()},this.groupByValue=function(){return t.get()}}function List(i,r){var i=i&&i.constructor==Array&&i||[],o=addArrayFunctions([]),t=this;this.add=function(t){t&&(i.push(t),o.push(null))},this.get=function(){!function(){if(r){for(t=0;t<i.length;t++)o[t]=r(i[t])}else for(var t=0;t<i.length;t++)o[t]=i[t].value()}();for(var t=new Array(o.length),e=0;e<o.length;e++)if(o[e].constructor!=NodeReference&&o[e].constructor!=RelationshipReference)for(var n in t[e]=o[e],t[e].constructor=o[e].constructor,o[e])t[e][n]&&(t[e][n].constructor=o[e][n].constructor);else t[e]=o[e];return addArrayFunctions(t)},this.setElement=function(t,e){i[t]=e},this.getElements=function(){return i},this.next=function(){return!1},this.hasNext=function(){return!0},this.reset=function(){},this.getData=function(){return t},this.value=function(){return t.get()},this.type=function(){return t.constructor.name},this.groupByKey=function(){return t.get()},this.groupByValue=function(){return t.get()}}function Case(){var e,t=this,n=[],i=[];this.when=function(t){n.push(t)},this.whenCount=function(){return n.length},this.then=function(t){i.push(t)},this.else=function(t){e=t},this.get=function(){return this.value()},this.next=function(){return!1},this.hasNext=function(){return!0},this.reset=function(){},this.getData=function(){return t},this.value=function(){for(var t=0;t<n.length;t++)if(n[t].value())return i[t].value();return e.value()},this.type=function(){return t.constructor.name},this.groupByKey=function(){return t.get()},this.groupByValue=function(){return t.get()}}function Constant(t){var e=t;this.get=function(){return e},this.next=function(){return!1},this.hasNext=function(){return!0},this.reset=function(){},this.getData=function(){return this},this.getObject=function(){return e},this.value=function(){return e},this.id=function(){return e.id},this.setValue=function(t){e=t},this.type=function(){return this.constructor.name},this.groupByKey=function(){return e},this.groupByValue=function(){return e}}function Table(t,e){var t=t,n=e,i={};this.addColumn=function(t){return i[t]=new TableColumn(this,t),i[t]},this.addValue=function(t,e){i[t].addValue(e)},this.getColumn=function(t){return i[t]},this.name=function(){return n},t.addTable(this)}function TableColumn(t,e){var n=e,i=[],r=[],o=0,u=0;this.addValue=function(t){0<r.length?r[r.length-1]==t?i[i.length-1]++:r[r.length-1]!=t&&(r.push(t),i.push(1)):0==r.length&&(r.push(t),i.push(1))},this.value=function(){return u>i[o]&&(u=0,o++),u++,r[o]},this.reset=function(){u=o=0},this.name=function(){return n}}}function XMLHttpRequestFactory(){try{return new XMLHttpRequest}catch(t){}return new function(){this.UNSENT=0,this.OPENED=1,this.HEADERS_RECEIVED=2,this.LOADING=3,this.DONE=4,this.readyState=this.UNSENT,this.status=null,this.responseText=null,this.response=null,this.responseType=null,this.method=null,this.url=null,this.async=!0,this.onreadystatechange=function(){},this.onload=function(){},this.open=function(t,e,n){this.method=t.toUpperCase(),this.url=e,this.async=n,this.readyState=this.OPENED},this.send=function(t){var e=null,n=0==this.url.indexOf("https");try{e=n?require("https"):require("http")}catch(t){}var i=this;"GET"==i.method&&(e.get(this.url,function(t){var e="";t.on("data",function(t){e+=t}),t.on("end",function(){i.responseText=e,i.response=e,i.readyState=i.DONE,i.status=200,i.onreadystatechange()})}).on("error",function(t){console.log("Error: "+t),i.status=0,i.onreadystatechange()}),this.onload(this))}}}function HTTP(){this.get=function(t,i,r){var o=XMLHttpRequestFactory();o.onreadystatechange=function(){var t,e,n;e=i,n=r,4==(t=o).readyState&&(200==t.status?e(t.responseText):200!=t.status&&(0==t.status?n('Access denied for URL resource "'+url+'".'):404==t.status&&n('URL resource "'+url+'" not found.')))},o.open("GET",t,!0),o.send()}}var http=new HTTP;{function Expression(t,e,n,i,r,o){var u=t,s=u.element&&u.element().getKey?u.element().getKey():e,a=n,c=i,h=r;if(a){c.addReduceExpression(this);for(var f=0;f<a.length;f++)a[f].setGroupBy(c.getGroupBy()),a[f].setReducer(c.getGroupBy().addReducer()),a[f].initialize()}if(this.root=function(){return u},this.rootObject=function(){return u.element().getObject?u.element().getObject():u.element()},this.value=function(){return u.value()},this.getData=function(){return this.value()},this.getAlias=function(){return s},this.variableReferences=function(){return h},this.hasReferredVariables=function(){return h&&0<h.length},this.setAlias=function(t){},this.hasKey=function(){return u.hasKey&&u.hasKey()},this.isReduceExpression=function(){return null!=a},this.aggregate=function(){if(a)for(var t=0;t<a.length;t++)a[t].aggregate();else c.getGroupBy().map(u)},this.hasAggregateFunctions=function(){return null!=a},this.isArray=function(){return u.element().constructor==List},this.isAssociativeArray=function(){return u.element().constructor==AssociativeArray},this.getAggregateFunctions=function(){return a},this.type=function(){return this.constructor.name},u.element().constructor==List){r=u.element().getElements(),f=0;if(f<r.length)return void(r[f].hasAggregateFunctions&&(this.hasAggregateFunctions=function(){return!0}))}u.non_deterministic=function(){return o},this.mappable=function(){return u.mappable()}}function Variable(t,e){var n=t,i=e,r=null;this.getObjectKey=function(){return i},this.getObject=function(){return r||(n.constructor==Constant?n.getObject():n)},this.value=function(t){if(r)return r;try{return n.getData().get(t)}catch(t){}return null},this.setOverriddenValue=function(t){r=t}}function Statement(_engine){var engine=_engine,operations=[],variables={},lastVariable,lastPropertyKey,output=[],graph={nodes:{},relationships:{}},nodesAdded=0,relationshipsAdded=0,overriddenContextStack=[],overriddenContext=void 0;this.addOperation=function(t){if(this.context()&&"Return"==this.context().type())throw"There can only be one return statement and it must be last in the query.";this.context()&&this.context().setNextOperation(t),operations.push(t)},this.operations=function(){return operations},this.context=function(){return overriddenContext||operations[operations.length-1]},this.setContext=function(t){overriddenContext&&overriddenContextStack.push(overriddenContext),overriddenContext=t},this.resetContext=function(){overriddenContext=overriddenContextStack.pop()},this.addVariable=function(t,e){if(lastVariable=new Variable(e,t),variables[t])throw"Variable `"+t+"` already declared.";variables[t]=lastVariable},this.debugVariables=function(){for(var t in variables)console.log('Variable "'+t+'":'),console.log(JSON.stringify(variables[t].value()))},this.variables=function(){return Object.values(variables)},this.getVariable=function(key){if(null!=variables[key])return variables[key];try{return{value:function(){return eval(key)}}}catch(e){}throw"Variable `"+key+"` has not been declared."},this.hasVariable=function(t){return null!=variables[t]},this.getLastVariable=function(){return lastVariable},this.setPropertyKey=function(t){lastPropertyKey=t},this.getPropertyKey=function(){return lastPropertyKey},this.clear=function(){operations=[],variables={},variableList=[],lastPropertyKey=lastVariable=void 0,output=[],relationshipsAdded=nodesAdded=0,graph={nodes:{},relationships:{}}},this.engine=function(){return engine},this.results=function(){return checkGraphConsistency(),{output:output,graph:{nodes:Object.values(graph.nodes),links:Object.values(graph.relationships)},stats:{nodesAdded:nodesAdded,relationshipsAdded:relationshipsAdded}}},this.addOutputRecord=function(){output.push({})},this.addOutputEntry=function(t,e,n){null!=output[output.length-1][t]&&(t+=n),this.addOutputEntryToGraph(e),output[output.length-1][t]=clean(e)};var checkGraphConsistency=function(){var t,e,n=[];for(e in graph.relationships)t=graph.relationships[e],graph.nodes[t.source]&&graph.nodes[t.target]||n.push(e);for(var i=0;i<n.length;i++)delete graph.relationships[n[i]]};this.addOutputEntryToGraph=function(t){if(t&&t.constructor==NodeReference)null==graph.nodes[t.id()]&&(graph.nodes[t.id()]=clean(t));else if(t&&t.constructor==RelationshipReference){var e;null==graph.relationships[t.id()]&&((e=t.getObject().toObject()).source=e.fromNode.id(),e.target=e.toNode.id(),graph.relationships[t.id()]=clean(e))}else if(t&&t.constructor==Array)for(var n=0;n<t.length;n++)this.addOutputEntryToGraph(t[n])},this.setNodesAdded=function(t){nodesAdded=t},this.setRelationshipsAdded=function(t){relationshipsAdded=t},this.getNodesAdded=function(){return nodesAdded},this.getRelationshipsAdded=function(){return relationshipsAdded},this.setSuccessCallback=function(t){successCallback=t},this.success=function(){successCallback(this.results())}}function Where(t){var e=t;this.evaluate=function(){return 1==e.value()}}function Inserter(t,e){var i,n,r=[],o=new Table(t,e);this.setPreviousOperation=function(t){var e;i=t;for(var n=0;n<i.variables().length;n++)e=i.variables()[n],r.push(o.addColumn(e.getObjectKey()))},this.setNextOperation=function(t){(n=t).setPreviousOperation(this)},this.variables=function(){return i.variables()},this.doIt=function(){for(var t,e=0;e<i.variables().length;e++)t=i.variables()[e],r[e].addValue(r[e].name(),t.value());n&&n.doIt()},this.finish=function(){n&&n.finish()},this.run=function(){throw"Into-operation cannot be first in statement."},this.type=function(){return this.constructor.name}}function Setter(){var i,e,n;function r(t,e,n){var i=t,r=e,o=n;this.set=function(){var t,e=i.getObject();if((e=e.constructor==Unwind?e.value():e).constructor==NodeReference)t=e.getObject();else if(e.constructor==Node)t=e.getData();else if(e.constructor==RelationshipReference)t=e.getObject();else{if(e.constructor!=Relationship)throw'Cannot assign to object of type "'+e.constructor.name+'".';t=e.getData()}try{t.setProperty(r,o),t.bindProperty(r)}catch(t){}}}function o(t,e){var n=t,i=e;this.set=function(){var t,e=n.getObject();if((e=e.constructor==Unwind?e.value():e).constructor==NodeReference||e.constructor==RelationshipReference)t=e.getObject();else{if(e.constructor!=Node&&e.constructor!=Relationship)throw'Cannot assign to object of type "'+e.constructor.name+'".';t=e.getData()}t.setProperties(i.value())}}function u(t,e){var n=t,i=e;this.set=function(){var t,e=n.getObject();if((e=e.constructor==Unwind?e.value():e).constructor==NodeReference)t=e.getObject();else{if(e.constructor!=Node)throw'Cannot assign to object of type "'+e.constructor.name+'".';t=e.getData()}t.setLabel(i.value(),t.getId())}}function s(t,e){var n=t,i=e;this.set=function(){var t,e=n.getObject();if((e=e.constructor==Unwind?e.value():e).constructor==RelationshipReference)t=e.getObject();else{if(e.constructor!=Relationship)throw'Cannot assign to object of type "'+e.constructor.name+'".';t=e.getData()}try{t.setType(i.value(),t.id())}catch(t){}}}this.addSetter=function(t,e,n){(i=i||[]).push(new r(t,e,n))},this.addLabelSetter=function(t,e){(i=i||[]).push(new u(t,e))},this.addMapSetter=function(t,e){(i=i||[]).push(new o(t,e))},this.addTypeSetter=function(t,e){(i=i||[]).push(new s(t,e))},this.setPreviousOperation=function(t){e=t},this.setNextOperation=function(t){(n=t).setPreviousOperation(this)},this.variables=function(){return e.variables()},this.doIt=function(){for(var t=0;t<i.length;t++)i[t].set();n&&n.doIt()},this.finish=function(){n&&n.finish()},this.run=function(){throw"Set-operation cannot be first in statement."},this.type=function(){return this.constructor.name}}function Create(t){var e,n,i,r=t,o=[];this.where=function(t){i=new Where(t)},this.addPattern=function(){o.push(new Pattern)};var u=function(){return o[o.length-1]};this.getPattern=function(){return u()},this.addNode=function(t){u().addNode(t)},this.addRelationship=function(t){u().addRelationship(t)},this.variable=function(t){r.addVariable(t,this.getLast())},this.getLast=function(t){return u().lastObject()},this.setPreviousOperation=function(t){e=t},this.setNextOperation=function(t){(n=t).setPreviousOperation(this)},this.previousOperation=function(){return e};function s(){n&&u().setNextAction(function(){i&&!i.evaluate()||n.doIt()})}this.doIt=function(){if(e.constructor==Merge)throw"WITH is required between MERGE and CREATE";s(),this.doIt=function(){for(var t=0;t<o.length;t++)o[t].create()},this.doIt()},this.finish=function(){n?n.finish():r.success()},this.run=function(){s();for(var t=0;t<o.length;t++)o[t].create();n&&n.finish()},this.type=function(){return this.constructor.name},this.variables=function(){return r.variables()}}function Match(t){var e,n,i,r=t,o=[];this.where=function(t){i=new Where(t)},this.addPattern=function(){o.push(new Pattern)};var u=function(){return o[o.length-1]};this.getPattern=function(){return u()},this.addNode=function(t){u().addNode(t)},this.addRelationship=function(t){u().addRelationship(t)},this.variable=function(t){r.addVariable(t,this.getLast())},this.getLast=function(t){return u().lastObject()},this.setPreviousOperation=function(t){e=t},this.setNextOperation=function(t){(n=t).setPreviousOperation(this)},this.previousOperation=function(){return e};function s(){n&&u().setNextAction(function(){i&&!i.evaluate()||n.doIt()})}this.doIt=function(){if(e.constructor==Merge)throw"WITH is required between MERGE and MATCH";s(),this.doIt=function(){for(var t=0;t<o.length;t++)o[t].match()},this.doIt()},this.finish=function(){if(n){for(var t=0;t<o.length;t++)o[t].finish();n.finish()}else r.success()},this.run=function(){s();for(var t=0;t<o.length;t++)o[t].match();if(n){for(t=0;t<o.length;t++)o[t].finish();n.finish()}},this.type=function(){return this.constructor.name},this.variables=function(){return r.variables()}}function Merge(t){var e,n,i,r=t,o=[];this.where=function(t){i=new Where(t)},this.addPattern=function(){o.push(new Pattern)};var u=function(){return o[o.length-1]};this.addNode=function(t){u().addNode(t)},this.addRelationship=function(t){u().addRelationship(t)},this.getLast=function(t){return u().lastObject()},this.variable=function(t){this.getLast().setVariableKey(t),r.addVariable(t,this.getLast())},this.setPreviousOperation=function(t){e=t},this.setNextOperation=function(t){(n=t).setPreviousOperation(this)},this.previousOperation=function(){return e};function s(){n&&u().setNextAction(function(){i&&!i.evaluate()||n.doIt()})}this.doIt=function(){s(),this.doIt=function(){u().merge()},this.doIt()},this.finish=function(){n?n.finish():r.success()},this.run=function(){s(),u().merge(),n&&n.finish()},this.type=function(){return this.constructor.name},this.variables=function(){return r.variables()}}function GroupBy(n){function i(t){return{value:t,map:{}}}var r,n=n,t=null,e=0,o=new StringRecoder;this.getTrieRoot=function(){return t},this.beginMap=function(){null==t&&(t=i()),r=t},this.beginMap(),this.map=function(t){t.non_deterministic()&&t.precalculate();var e=null==(e=t.groupByKey())?e:e.constructor==NodeReference||e.constructor==RelationshipReference?e.id():e.constructor==Array||e.constructor==Object?JSON.stringify(e):o.recode(e),t=t.groupByValue();r.map[e]||(r.map[e]=i(t)),r=r.map[e]},this.getReducer=function(t){return r.reducers||(r.reducers=new Array(e)),r.reducers[t]||(r.reducers[t]={}),r.reducers[t]},this.addReducer=function(){return e++},this.print=function(){u(t)};var u=function(t){for(var e in t.map)n.setNextMapValue(t.map[e].value),u(t.map[e]),n.moveToPreviousMapValue();e||(r=t,n.addAggregateOutputRecord())}}function ReturnValue(t,e,n,i){var r,o=t,u=e,s=o.getAlias(),a=0,c=this,h=i,f=n;this.getAlias=function(){return s},this.setAlias=function(t){s=t,u.addVariable(s,this)},this.hasKey=function(){return o.hasKey()},this.setId=function(t){a=t},this.getId=function(){return a},this.value=function(){return null!=r?r:o.value()},this.groupByKey=function(){return this.value()},this.groupByValue=function(){return this.value()},this.get=function(){return c.value()},this.getData=function(){return c},this.getExpression=function(){return o},this.setGroupByValue=function(t){o.isArray()&&o.hasAggregateFunctions()||(r=t)},this.nextAction=function(){},this.setNextAction=function(t){this.nextAction=t},this.hidden=function(){return h},this.parent=function(){return f},this.type=function(){return this.constructor.name}}function Return(t){var e,a,n,i,r,o,u,c=t,h=[],s=0,f=!1,l=!1,d=this,p=0,g=0;this.where=function(t){o=new Where(t)},this.limit=function(t){u=t},this.expression=function(t){w(t)},this.getLast=function(){return h[m()]},this.getGroupBy=function(){return e=null==e?new GroupBy(this):e},this.hasGroupBy=function(){return null!=e},this.hasMapKeys=function(){return a&&0<a.length},this.doItCount=function(){return g};var y=function(){return null!=u},v=function(){return y()&&p>=u.value()},b=function(){return!o||o.evaluate()};this.addReduceExpression=function(t){(n=n||[]).push(t)},this.setNextMapValue=function(t){a[s++].setGroupByValue(t)},this.moveToPreviousMapValue=function(){s--},this.addAggregateOutputRecord=function(){if(b()&&!(0==this.doItCount()&&this.hasMapKeys()||v())){for(var t=0;t<h.length;t++)h[t].nextAction();p++,r&&r.doIt()}},this.setReturnValueNextAction=function(t){t.setNextAction(function(){0==t.getId()&&c.addOutputRecord(),t.hidden()||c.addOutputEntry(t.getAlias(),t.value(),t.getId())})};var w=function(t,e){var n=!1;if(t.isArray())for(var i=t.root().element(),r=0;r<i.getElements().length;r++){var o=w(i.getElements()[r],!0);i.setElement(r,o),n=!0}else if(t.isAssociativeArray())for(var u=t.root().element(),s=u.getValues(),r=0;r<s.length;r++){o=w(s[r],!0);u.setValue(r,o),n=!0}e=new ReturnValue(t,c,d,e);return h.push(e),h[m()].setId(m()),e.getExpression().isReduceExpression()||n||!e.getExpression().mappable()||(a=a||[]).push(e),d.setReturnValueNextAction(e),l=t.hasReferredVariables(),e};this.setIsIntermediary=function(){f=!0},this.conveyorBeltEnd=function(){return!l&&f&&!n};var m=function(){return h.length-1};this.setPreviousOperation=function(t){i=t},this.setNextOperation=function(t){(r=t).setPreviousOperation(this)},this.previousOperation=function(){return i},this.nextOperation=function(){return r},this.variables=function(){if(!r&&i)return i.variables();for(var t=[],e=0;e<h.length;e++)h[e].hidden()||t.push(c.getVariable(h[e].getAlias()));return t},this.type=function(){return this.constructor.name};function R(){if(g++,d.hasGroupBy()){if(d.hasGroupBy()){if(e.beginMap(),a)for(t=0;t<a.length;t++)a[t].getExpression().aggregate();for(t=0;t<n.length;t++)n[t].aggregate()}}else if(b()&&!v()){for(var t=0;t<h.length;t++)h[t].nextAction();p++,r&&r.doIt()}}this.doIt=function(){this.conveyorBeltEnd()||R()},this.finish=function(){this.conveyorBeltEnd()&&R(),this.hasGroupBy()&&e.print(),r?r.finish():c.success()},this.run=function(){R(),(r||this).finish()}}function With(t){var e=new Return(t),n=this.constructor.name;return e.setReturnValueNextAction=function(t){t.hidden()||t.setNextAction(function(){e.hasGroupBy()&&statement.getVariable(t.getAlias()).setOverriddenValue(t.value())})},e.type=function(){return n},e.setIsIntermediary(),e}function Unwind(t){var e,n,i,r,o,u=t,s=0;this.doIt=function(){if(n&&(r=i.value())){if(!Array.isArray(r))throw"Unwind expects list expression.";for(s=0;s<r.length;s++)n.doIt()}},this.finish=function(){n&&n.finish()},this.run=function(){this.doIt(),n&&n.finish()},this.variable=function(t){o=t,u.addVariable(t,this)},this.variables=function(){return[u.getVariable(o)]},this.expression=function(t){i=t},this.setPreviousOperation=function(t){e=t},this.setNextOperation=function(t){(n=t).setPreviousOperation(this)},this.previousOperation=function(){return e},this.nextOperation=function(){return n},this.value=function(){return r[s]},this.groupByKey=this.value,this.groupByValue=this.value,this.get=function(){return this.value()},this.getData=function(){return this},this.type=function(){return this.constructor.name}}function Load(t){var b,e,n=t,i=null,w=!1,r=",",o=null,m=null,u=null,s=0,a=0,c=n.engine().getDataDownloadProxy();this.runCount=function(){return s},this.increaseRunCount=function(){s++},this.getRunId=function(){return++a},this.csv=function(){i="CSV"},this.json=function(){i="JSON"},this.loadType=function(){return i},this.headers=function(){w=!0},this.setFieldTerminator=function(t){if(1<t.length||0==t.length)throw"Field terminator must be one char.";r=t},this.fieldTerminator=function(){return r},this.expression=function(t){o=t},this.getLast=function(){return o},this.variable=function(t){n.addVariable(t,this)},this.getProperty=function(t){return b[t]},this.from=function(){return c?c+o.value():o.value()},this.get=function(){return b},this.value=function(){return this.get()},this.groupByKey=function(){return b},this.groupByValue=function(){return this.get()},this.getData=function(){return this},this.statement=function(){return n},this.setPreviousOperation=function(t){e=t},this.setNextOperation=function(t){(u=t).setPreviousOperation(this)},this.previousOperation=function(){return e},this.variables=function(){return n.variables()};function h(t,e){function n(){return v()?"\0":m.charAt(c)}function i(){for(var t="";!(g()||y()||v())||h;)t+=d()?(a=m.charAt(++c),'""'):a,l();0==s&&(w?r.push(t):r.push(r.length)),(0<s&&w||!w)&&(u[r[o++]]=t),g()&&l()}for(var r=[],o=0,u={},s=0,a="",c=0,h=!1,f=t||",",l=function(){pc=a,a=m.charAt(c++),p()&&(h=!h,l())},d=function(){return'"'==a&&'"'==n()},p=function(){return!d()&&'"'==a},g=function(){return a==f},y=function(){return"\r"==a&&"\n"==n()&&l(),"\n"==a},v=function(){return c>=m.length};!v();){for(;!y()&&!v();)i();0<s++&&(b=u,u={},o=0,e()),l()}}function f(t,e){if(t.constructor==Array)for(var n=0;n<t.length;n++)b=addAssociativeArrayFunctions(t[n]),e();else t.constructor==Object&&(b=addAssociativeArrayFunctions(t),e())}this.doIt=function(){this.run()},this.finish=function(){},this.run=function(){var t,n=this,e=n.from();n.increaseRunCount(),e.constructor==String?http.get(n.from(),function(t){var e=n.getRunId();"CSV"==n.loadType()?(m=t,h(n.fieldTerminator(),function(){u.doIt()})):"JSON"==n.loadType()&&f(JSON.parse(t),function(){u.doIt()}),e==n.runCount()&&u.finish()},function(t){throw n.type()+": "+t}):e.constructor!=String&&"JSON"==n.loadType()&&(t=n.getRunId(),f(e,function(){u.doIt()}),t==n.runCount()&&u.finish())},this.type=function(){return this.constructor.name}}}{var Trie={buildTrie:function(t){var e,n={};for(key in t){for(var i=t[key].displayValue(),r=n,o=0;o<i.length;o++)r[e=i.charAt(o).toUpperCase()]||(r[e]={}),r=r[e];r.isF=!0,r.f=t[key]}return n},isF:function(t,e,n,i,r){for(var o,u=e,s=i,a=function(t){return n.charAt(t).toUpperCase()};;){if(!u[a(s)])return 0;if((u=u[a(s)]).isF&&!u[a(s+1)]&&(o=s+1,!!r||(" "==a(o)||"("==a(o)||")"==a(o)||","==a(o)||""==a(o)||"}"==a(o))))return t.latestParsed=u.f,s-i+1;s++}}};{function KeyWord(t,e){this.action=e,this.displayValue=function(){return t}}KeyWord.f={},KeyWord.f.CREATE=new KeyWord("CREATE",function(t){t.create()}),KeyWord.f.MATCH=new KeyWord("MATCH",function(t){t.match()}),KeyWord.f.MERGE=new KeyWord("MERGE",function(t){t.merge()}),KeyWord.f.WITH=new KeyWord("WITH",function(t){t._with()}),KeyWord.f.RETURN=new KeyWord("RETURN",function(t){t._return()}),KeyWord.f.INTO=new KeyWord("INTO",function(t){t.into()}),KeyWord.f.LIMIT=new KeyWord("LIMIT",function(t){}),KeyWord.f.UNWIND=new KeyWord("UNWIND",function(t){t.unwind()}),KeyWord.f.WHERE=new KeyWord("WHERE",function(t){}),KeyWord.f.LOAD=new KeyWord("LOAD",function(t){t.load()}),KeyWord.f.CSV=new KeyWord("CSV",function(t){t.csv()}),KeyWord.f.JSON=new KeyWord("JSON",function(t){t.json()}),KeyWord.f.HEADERS=new KeyWord("HEADERS",function(t){t.headers()}),KeyWord.f.FROM=new KeyWord("FROM",function(t){}),KeyWord.f.AS=new KeyWord("AS",function(t){}),KeyWord.f.FIELDTERMINATOR=new KeyWord("FIELDTERMINATOR",function(t){}),KeyWord.f.SET=new KeyWord("SET",function(t){}),KeyWord.f.DISTINCT=new KeyWord("DISTINCT",function(t){}),KeyWord.f.TRUE=new KeyWord("TRUE",function(t){}),KeyWord.f.FALSE=new KeyWord("FALSE",function(t){}),KeyWord.f.NULL=new KeyWord("NULL",function(t){}),KeyWord.f.CASE=new KeyWord("CASE",function(t){}),KeyWord.f.WHEN=new KeyWord("WHEN",function(t){}),KeyWord.f.THEN=new KeyWord("THEN",function(t){}),KeyWord.f.ELSE=new KeyWord("ELSE",function(t){}),KeyWord.f.END=new KeyWord("END",function(t){}),KeyWord.f.SHORTESTPATH=new KeyWord("SHORTESTPATH",function(t){}),KeyWord.trie=Trie.buildTrie(KeyWord.f),KeyWord.isKeyWord=function(t,e){return Trie.isF(KeyWord,KeyWord.trie,t,e)}}{function Operator(t,e,n,i){this.value=i,this.isOperator=!0,this.displayValue=function(){return t},this.precedence=function(){return e},this.leftAssociativity=function(){return n},this.rightAssociativity=function(){return!n}}Operator.f={},Operator.f.POWER=new Operator("^",11,!1,function(){return Math.pow(this.lhs.value(),this.rhs.value())}),Operator.f.MULTIPLY=new Operator("*",10,!0,function(){return this.lhs.value()*this.rhs.value()}),Operator.f.DIVIDE=new Operator("/",10,!0,function(){return this.lhs.value()/this.rhs.value()}),Operator.f.MODULO=new Operator("%",10,!0,function(){return this.lhs.value()%this.rhs.value()}),Operator.f.SET_UNION=new Operator("|",10,!0,function(){try{return Array.from(new Set(this.lhs.value().concat(this.rhs.value())))}catch(t){return console.log(t),null}}),Operator.f.SET_INTERSECT=new Operator("&",10,!0,function(){try{var t,e=new Set(this.lhs.value()),n=new Set(this.rhs.value()),i=new Set;for(t of n)console.log(t),e.has(t)&&i.add(t);return Array.from(i)}catch(t){return console.log(t),null}}),Operator.f.PLUS=new Operator("+",9,!0,function(){return this.lhs.value().constructor==Array?this.lhs.value().concat(this.rhs.value()):this.rhs.value().constructor==Array?[this.lhs.value()].concat(this.rhs.value()):this.lhs.value()+this.rhs.value()}),Operator.f.MINUS=new Operator("-",9,!0,function(){var t=this.lhs.value(),e=this.rhs.value();if(t.constructor!=Array||e.constructor!=Array)return t-e;var n,i=new Set(t);for(n of new Set(e))i.delete(n);return Array.from(i)}),Operator.f.GREATER_THAN=new Operator(">",8,!0,function(){return this.lhs.value()>this.rhs.value()}),Operator.f.LESS_THAN=new Operator("<",8,!0,function(){return this.lhs.value()<this.rhs.value()}),Operator.f.GREATER_THAN_OR_EQUALS=new Operator(">=",8,!0,function(){return this.lhs.value()>=this.rhs.value()}),Operator.f.LESS_THAN_OR_EQUALS=new Operator("<=",8,!0,function(){return this.lhs.value()<=this.rhs.value()}),Operator.f.EQUALS=new Operator("=",7,!0,function(){return this.lhs.value()==this.rhs.value()}),Operator.f.NOT_EQUALS=new Operator("<>",7,!0,function(){return this.lhs.value()!=this.rhs.value()}),Operator.f.IN=new Operator("IN",7,!0,function(){return this.rhs.value().constructor!=Array&&function(){throw"Not a list expression."}(),-1<this.rhs.value().indexOf(this.lhs.value())}),Operator.f.IS=new Operator("IS",7,!0,function(){return this.lhs.value()==this.rhs.value()}),Operator.f.AND=new Operator("AND",6,!0,function(){return this.lhs.value()&&this.rhs.value()}),Operator.f.OR=new Operator("OR",5,!0,function(){return this.lhs.value()||this.rhs.value()}),Operator.f.NONE=new Operator("NONE",-1,!0,null),Operator.trie=Trie.buildTrie(Operator.f),Operator.latestParsed=null,Operator.isOperator=function(t,e){return Trie.isF(Operator,Operator.trie,t,e,!0)}}{function _Function(t,e,n,i,r){var o=t,u=e,s=n,a=r;this.value=i,this.getObject=i,this.groupByKey=i,this.groupByValue=i,this.isFunction=!0,this.displayValue=function(){return o},this.parametric=function(){return 0<u},this.precedence=function(){return 12},this.leftAssociativity=function(){return!0},this.rightAssociativity=function(){return!this.leftAssociativity},this.verifyParsedParameterCount=function(t){if(t<u)throw'Too few parameters for function "'+o+'".';if(s<t)throw'Too many parameters for function "'+o+'".'},this.returnType=function(){return a}}_Function.f={},_Function.f.PI=new _Function("PI",0,0,function(){return Math.PI}),_Function.f.E=new _Function("E",0,0,function(){return Math.E}),_Function.f.exp=new _Function("exp",1,1,function(){return Math.pow(Math.E,this.p[0].value())}),_Function.f.sqrt=new _Function("sqrt",1,1,function(){return Math.sqrt(this.p[0].value())}),_Function.f.log=new _Function("log",2,2,function(){return Math.log(this.p[0].value())/(this.p[1].value()?Math.log(this.p[1].value()):1)}),_Function.f.ln=new _Function("ln",1,1,function(){return Math.log(this.p[0].value())}),_Function.f.sin=new _Function("sin",1,1,function(){return Math.sin(this.p[0].value())}),_Function.f.cos=new _Function("cos",1,1,function(){return Math.cos(this.p[0].value())}),_Function.f.id=new _Function("id",1,1,function(){return this.p[0].value().id()}),_Function.f.labels=new _Function("labels",1,1,function(){return this.p[0].value().getLabels()}),_Function.f.type=new _Function("type",1,1,function(){return this.p[0].value().getType()}),_Function.f.startnode=new _Function("startnode",1,1,function(){return this.p[0].value().startNode()}),_Function.f.endnode=new _Function("endnode",1,1,function(){return this.p[0].value().endNode()}),_Function.f.properties=new _Function("properties",1,1,function(){return this.p[0].value().getProperties()}),_Function.f.exists=new _Function("exists",1,1,function(){return null!=this.p[0].value()}),_Function.f.keys=new _Function("keys",1,1,function(){try{return this.p[0].value().getKeys()}catch(t){}return Object.keys(this.p[0].value())}),_Function.f.nodes=new _Function("nodes",1,1,function(){return this.p[0].value().getNodes()}),_Function.f.relationships=new _Function("relationships",1,1,function(){return this.p[0].value().getRelationships()}),_Function.f.head=new _Function("head",1,1,function(){return this.p[0].value().shift?this.p[0].value().shift():null}),_Function.f.last=new _Function("last",1,1,function(){return 0<this.p[0].value().length?this.p[0].value()[this.p[0].value().length-1]:null}),_Function.f.size=new _Function("size",1,1,function(){return this.p[0].value().length}),_Function.f.object_lookup=new _Function("object_lookup",2,2,function(){if(this.p[0].value().getProperty)return this.p[0].value().getProperty(this.p[1].value());try{return this.p[0].value()[this.p[1].value()]}catch(t){}return null}),_Function.f.array_lookup=new _Function("array_lookup",2,2,function(){try{return this.p[0].value()[this.p[1].value()]}catch(t){}return null}),_Function.f.split=new _Function("split",2,2,function(){return addArrayFunctions(this.p[0].value().split(this.p[1].value()))},List),_Function.f.join=new _Function("join",1,2,function(){var t=null!=this.p[1]&&this.p[1].value()||",";return this.p[0].value().join(t)}),_Function.f.trim=new _Function("trim",1,1,function(){return this.p[0].value().trim()}),_Function.f.range=new _Function("range",2,3,function(){var t=parseInt(this.p[0].value()),e=parseInt(this.p[1].value()),n=null!=this.p[2]&&parseInt(this.p[2].value())||1;if(0==n)throw"Zero step-size not allowed";if(n<0&&0<e&&t<e)throw"Negative step-size and positive end of range not allowed.";if(0<n&&e<0)throw"Positive step-size and negative end of range not allowed.";if(e<t&&0<n)throw"End of range smaller than start of range and positive step-size not allowed.";for(var i=[],r=t;r!=e;r+=n)i.push(r);return addArrayFunctions(i)},List),_Function.f.lower=new _Function("lower",1,1,function(){return this.p[0].value().toLowerCase()}),_Function.f.upper=new _Function("upper",1,1,function(){return this.p[0].value().toUpperCase()}),_Function.f.toint=new _Function("toint",1,1,function(){return parseInt(this.p[0].value())}),_Function.f.tofloat=new _Function("tofloat",1,1,function(){return parseFloat(this.p[0].value())}),_Function.f.tostring=new _Function("tostring",1,1,function(){try{return this.p[0].value().toString()}catch(t){}return this.p[0].value()+""}),_Function.f.todate=new _Function("todate",1,1,function(){return new Date(this.p[0].value())}),_Function.f.coalesce=new _Function("coalesce",2,2,function(){return(null==this.p[0].value()?this.p[1]:this.p[0]).value()}),_Function.f.round=new _Function("round",1,1,function(){return Math.round(this.p[0].value())}),_Function.f.rand=new _Function("rand",0,0,function(){return Math.random()}),_Function.f.rand.non_deterministic=!0,_Function.f.timestamp=new _Function("timestamp",0,0,function(){return new Date}),_Function.f.not=new _Function("not",1,1,function(){return!this.p[0].value()}),_Function.trie=Trie.buildTrie(_Function.f),_Function.latestParsed=null,_Function.isFunction=function(t,e){return Trie.isF(_Function,_Function.trie,t,e)}}{function AggregateFunction(t,e,n,i,r,o,u){var s=t,a=0,c=e,h=n,f=u;this.initialize=i,this.value=r,this.getObject=r,this.aggregate=o,this.isFunction=!0,this.initializeIfNecessary=function(){this.initialize()},this.displayValue=function(){return s},this.precedence=function(){return 12},this.leftAssociativity=function(){return!0},this.rightAssociativity=function(){return!this.leftAssociativity},this.parametric=function(){return 0<c},this.parsedParameterCount=function(){return a},this.verifyParsedParameterCount=function(t){if((a=t)<c)throw'Too few parameters for function "'+s+'".';if(h<a)throw'Too many parameters for function "'+s+'".'},this.returnType=function(){return f}}AggregateFunction.f={},AggregateFunction.f.sum=new AggregateFunction("sum",1,1,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.getGroupBy().getReducer(this.getReducerId()).result=0)},function(){return this.getGroupBy().getReducer(this.getReducerId()).result||new Number(0)},function(){this.initializeIfNecessary(),this.getGroupBy().getReducer(this.getReducerId()).result+=this.p[0].value()}),AggregateFunction.f.barchart=new AggregateFunction("barchart",1,1,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.getGroupBy().getReducer(this.getReducerId()).result={})},function(){return addAssociativeArrayFunctions(this.getGroupBy().getReducer(this.getReducerId()).result)},function(){this.initializeIfNecessary();var t=this.p[0].value().groupByKey&&this.p[0].value().groupByKey()||this.p[0].value();null==this.getGroupBy().getReducer(this.getReducerId()).result[t]&&(this.getGroupBy().getReducer(this.getReducerId()).result[t]=0),this.getGroupBy().getReducer(this.getReducerId()).result[t]++}),AggregateFunction.f.histogram=new AggregateFunction("histogram",1,2,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.getGroupBy().getReducer(this.getReducerId()).result={values:[],histogram:null})},function(){var t=this.getGroupBy().getReducer(this.getReducerId()).result;if(null==t.histogram){for(var e=this.p[1]&&this.p[1].value()||10,n=t.values[0],i=t.values[0],r=new Array(e).fill(0),o=0;o<t.values.length;o++)t.values[o]<n&&(n=t.values[o]),t.values[o]>i&&(i=t.values[o]);for(var u=(i-n)/e,o=0;o<t.values.length;o++)r[Math.floor(t.values[o]/u)]++;t.histogram=new Array(e);for(var s=n,o=0;o<e;o++)t.histogram[o]={label:"["+s+", "+(s+u)+">",value:r[o],from:s,to:s+u},s+=u}return addArrayFunctions(t.histogram)},function(){this.initializeIfNecessary(),this.getGroupBy().getReducer(this.getReducerId()).result.values.push(this.p[0].value())}),AggregateFunction.f.min=new AggregateFunction("min",1,1,function(){},function(){return this.getGroupBy().getReducer(this.getReducerId()).result},function(){(null==this.getGroupBy().getReducer(this.getReducerId()).result||this.p[0].value()<this.getGroupBy().getReducer(this.getReducerId()).result)&&(this.getGroupBy().getReducer(this.getReducerId()).result=this.p[0].value())}),AggregateFunction.f.max=new AggregateFunction("max",1,1,function(){},function(){return this.getGroupBy().getReducer(this.getReducerId()).result},function(){(null==this.getGroupBy().getReducer(this.getReducerId()).result||this.p[0].value()>this.getGroupBy().getReducer(this.getReducerId()).result)&&(this.getGroupBy().getReducer(this.getReducerId()).result=this.p[0].value())}),AggregateFunction.f.count=new AggregateFunction("count",1,1,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.distinct()?this.distinct()&&(this.getGroupBy().getReducer(this.getReducerId()).result={}):this.getGroupBy().getReducer(this.getReducerId()).result=0)},function(){return this.distinct()?this.distinct()?Object.keys(this.getGroupBy().getReducer(this.getReducerId()).result).length:void 0:this.getGroupBy().getReducer(this.getReducerId()).result||new Number(0)},function(){var t;this.initializeIfNecessary(),this.distinct()?this.distinct()&&(t=this.p[0].value().groupByKey&&this.p[0].value().groupByKey()||this.p[0].value(),t=JSON.stringify(t),null==this.getGroupBy().getReducer(this.getReducerId()).result[t]&&(this.getGroupBy().getReducer(this.getReducerId()).result[t]=!0)):this.getGroupBy().getReducer(this.getReducerId()).result+=1}),AggregateFunction.f.stdev=new AggregateFunction("stdev",1,1,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.getGroupBy().getReducer(this.getReducerId()).result=[])},function(){for(var t=0,e=this.getGroupBy().getReducer(this.getReducerId()).result,n=0;n<e.length;n++)t+=e[n];for(var i=t/e.length,t=0,n=0;n<e.length;n++)t+=Math.pow(e[n]-i,2);return Math.sqrt(t/(e.length-1))},function(){this.initializeIfNecessary(),this.getGroupBy().getReducer(this.getReducerId()).result.push(this.p[0].value())}),AggregateFunction.f.collect=new AggregateFunction("collect",1,1,function(){this.getGroupBy().getReducer(this.getReducerId()).result||(this.distinct()?this.distinct()&&(this.getGroupBy().getReducer(this.getReducerId()).result={}):this.getGroupBy().getReducer(this.getReducerId()).result=addArrayFunctions([]))},function(){return this.distinct()?this.distinct()?addArrayFunctions(Object.values(this.getGroupBy().getReducer(this.getReducerId()).result)):void 0:this.getGroupBy().getReducer(this.getReducerId()).result||addArrayFunctions([])},function(){this.initializeIfNecessary();var t=this.p[0].value();null!=t&&(this.distinct()?this.distinct()&&(t=this.p[0].value().groupByKey&&this.p[0].value().groupByKey()||this.p[0].value(),t=JSON.stringify(t),null==this.getGroupBy().getReducer(this.getReducerId()).result[t]&&(this.getGroupBy().getReducer(this.getReducerId()).result[t]=this.p[0].value())):this.getGroupBy().getReducer(this.getReducerId()).result.push(this.p[0].value()))},List),AggregateFunction.trie=Trie.buildTrie(AggregateFunction.f),AggregateFunction.latestParsed=null,AggregateFunction.isAggregateFunction=function(t,e){return Trie.isF(AggregateFunction,AggregateFunction.trie,t,e)}}function Parser(t){var i,c=t,e=void 0,r=0,n="",o=!1,u="(): {}\"',.\n+-/*^[]=<>!",s={},a=!1,h=function(){a=!0},f=function(){var t=a;return a=!1,t};this.statementText=function(){return i},this.position=function(){return r};var l=0,d=function(){return 0<l},p=function(){l++},g=function(){l--};!function(){for(var t=0;t<u.length;t++)s[u[t]]=!0}(),this.parse=function(t){i=t,n="",a=!1,l=r=0,y()};var y=function(){if((b()||B()||_()||C()||R()||x()||v())&&y(),Ne())throw Ye("Expected keyword.")},v=function(){return Je(),!!Yt()&&(j(),c.expression(),ct(),V(),!0)},b=function(){if(Je(),Qt()){if(Je(),Zt()){if(Je(),Ut(!0)&&(Je(),!te()))throw Ye("Expected HEADERS-keyword.");if(Je(),!ee())throw Ye("Expected FROM-keyword.");w(),m()}else{if(!$t())throw Ye("Expected CSV- or JSON-keyword.");if(Je(),!ee())throw Ye("Expected FROM-keyword.");w()}return!0}return!1},w=function(){if(j(),c.expression(),Je(),!at())throw Ye("Expected alias.")},m=function(){if(Je(),ie()){if(Je(),!ot())throw Ye("Expected single- or doublequoted string.");c.statement().context().setFieldTerminator(xe())}},R=function(){return Je(),!(!Ut()||!N(!0))&&(V(),!0)},x=function(){return Je(),!!zt()&&N()},N=function(t){do{if(Je(),Se())At();else if(j(),c.expression(),!st()&&t&&!c.lastObject().hasKey())throw Ye("Expression in WITH must be aliased (use AS).")}while(je());if(L(),Je(),D(),Je(),Jt()){if(Je(),!$())throw Ye("Expected table name.");c.insertInto(xe())}return!0},O=function(t){if(Me()){if(t&&c.pattern(),c.node(),X(!0)){var e=xe(),n=tt(),t=nt();if(n||t){if(c.variableExists(e))throw"It is not allowed to create a new node in this context.";c.variable(e)}else if(c.variableExists(e)){t=c.getVariable(e).getObject();if(!t.isNode())throw"Variable `"+e+"` is bound to a "+t.type()+".";c.lastObject().setReferredNode(t)}else c.variable(e)}else tt(),nt();if(!ke())throw Ye("Expecting closing parentheses.");return!0}return!1},E=function(){if(Se()){if("Merge"==c.operation()||"Create"==c.operation())throw"Variable path length not supported in this context.";if(c.context().setHasVariablePathLength(),ve()&&c.context().setPathLengthFrom(parseInt(xe())),Ke()){if(!Ke())throw Ye('Expected "."');ve()&&c.context().setPathLengthTo(parseInt(xe()))}return!0}return!1},A=function(){var t=Ee();if(Pe()){if(c.relationship(),t&&c.leftDirection(),Ue()){if(X(!0)){var e=xe(),n=et(),i=nt(),t=E();if(n||i||t){if(c.variableExists(e))throw"It is not allowed to create a new relationship in this context.";c.variable(e)}else if(c.variableExists(e)){t=c.getVariable(e).getObject();if(!t.isRelationship())throw"Variable `"+e+"` is bound to a "+t.type()+".";c.lastObject().setReferredRelationship(t)}else c.variable(e)}else et(),nt(),E();if(!ze())throw Ye("Expected closing square bracket.");if(!Pe())throw Ye("Expected relationship line.");return Ae()&&c.rightDirection(),!0}throw Ye("Expected opening square bracket.")}return!1},P=function(){if(we(),!Me())return!1;r--;var e=!1;try{var t=I();if(t){for(;S(t);)if(!I(t))throw Ye("Expecting node pattern.");return t.element().useAsCondition(),statement.resetContext(),t}}catch(t){throw e=!0,statement.resetContext(),t}return e||statement.resetContext(),!1},I=function(t){var e=t,n=!1;if(we(),Me()){if(h(),t=W(),e||(e=It(new Pattern),statement.setContext(e.element())),e.element().addNode(new Node(db)),t&&F(t)&&(e.element().lastObject().setReferredNode(t),n=!0),tt()&&(n=!0),nt()&&(n=!0),ke())return T(e.element().lastObject())?e:(me(),Ft(),!1);if(n)throw Ye("Expecting closing parentheses.");return me(),Ft(),!1}return!1},F=function(t){return t.rootObject().constructor==Node},T=function(t){return 0<t.getLabels().length||(0<t.getProperties().length||(!!t.getReferredNode()||0==t.getLabels().length&&0==t.getProperties().length&&!t.getReferredNode()))},S=function(t){var e,n=Ee();if(Pe()){if(t.element().addRelationship(new Relationship(db)),n&&t.element().leftDirection(),Ue()){if(X(!0)){n=xe();if(!c.variableExists(n))throw'Variable "'+n+'" does not exist.';if(!(e=c.getVariable(n).getObject()).isRelationship())throw"Variable `"+n+"` is bound to a "+e.type()+".";t.element().lastObject().setReferredRelationship(c.getVariable(n).getObject())}if(et(),nt(),E()&&e)throw"Path expansion not allowed for referred relationship.";if(!ze())throw Ye("Expected closing square bracket.");if(!Pe())throw Ye("Expected relationship line.");return Ae()&&c.rightDirection(),!0}throw Ye("Expected opening square bracket.")}return!1},K=function(t){var e=void 0;if(X(!0)){if(Je(),t&&Ve())throw Ye("Path variable not allowed in this context.");if(e=xe(),!Ve())throw Ye("Expected variable assignment.");Je()}var t=!1,n=0,i=0;if(kt()&&(t=!0,xe(),!Me()))throw Ye("Expected opening parentheses.");if(O(!0))for(n++,e&&statement.addVariable(e,statement.context().getLast().getPattern());A();){if(!O())throw Ye("Expecting node pattern.");n++,i++}if(t&&(0==i||1<i))throw"Expected single relationship pattern.";if(t&&!ke())throw Ye("Expected closing parentheses.");return t&&statement.context().getPattern().shortestpath(),0<n},_=function(){if(Je(),Mt()){if(Je(),!K())throw Ye("Expecting graph pattern.");return L(),V(),!0}return!1},B=function(){if(Je(),jt()){do{if(Je(),!K())throw Ye("Expecting graph pattern.")}while(je());return L(),V(),!0}return!1},C=function(){if(Je(),Wt()){do{if(Je(),!K())throw Ye("Expecting graph pattern.")}while(je());return L(),V(),!0}return!1},L=function(){Xt()&&(j(),c.where(parser.getExpression()))},V=function(){if(Je(),re()){c.setter();do{if(!X(!0))throw Ye("Expected variable.");var t=c.getVariable(xe());if(Ke()){if(!rt())throw Ye("Expected property key.");if(n=xe(),Je(),!Ve())throw Ye("Expected equals character (=).");Je(),j();var e=parser.getExpression();c.operationContext().addSetter(t,n,e)}else{var n=t.getObject().constructor;if(n!=Node&&n!=Relationship)throw"Can't assign a label/type to a \""+t.getObject().getType()+'".';if(Le()){if(!j())throw"Expected expression.";e=parser.getExpression();n==Node?c.operationContext().addLabelSetter(t,e):n==Relationship&&c.operationContext().addTypeSetter(t,e)}else if(De()){if(!j())throw"Expected expression.";e=parser.getExpression();n!=Node&&n!=Relationship||c.operationContext().addMapSetter(t,e)}}}while(je())}},D=function(){qt()&&(j(!0),c.limit(parser.getExpression()))},j=function(t){var e,n,i=!0;if(n=P())i=!1;else if(Me()){if(Vt(),n=j(t),!ke())throw Ye("Expected closing parentheses.");Dt()}else if(Gt())n=J();else if(Ht())n=z();else if(ut())n=Et(xe());else if(e=G())_t(e),i=!1;else if(X(!0)){if(t)throw Ye("Variables not allowed within this context.");n=Pt(xe())}else if(e=U())n=St(e);else if(e=H())n=Kt(e);else if(!f())throw Ye("Expected expression");return n&&i&&M(n),Je(),pe()&&(Lt(Operator.latestParsed),Je(),j()),n},W=function(){parser.addLayer(),j();var t=parser.getExpression();return parser.finishLayer(),t},M=function(t){for(;;)if(Ke()){if(!rt())throw Ye("Expected property key.");xt(t,xe())}else if(!k(t)){Ot();break}},k=function(t){if(Ue()){if(Nt(t,W()),!ze())throw Ye("Expected closing square bracket.");return!0}return!1},G=function(){if(ce()){Je();for(var t=new Case;he();){if(t.when(W()),Je(),!fe())throw Ye("Expected THEN keyword");t.then(W()),Je()}if(0==t.whenCount())throw Ye("Expected WHEN keyword");if(Je(),le()&&t.else(W()),Je(),!de())throw Ye("Expected END keyword");return t}return!1},H=function(){if(Ge()){var t=new AssociativeArray;do{if(rt()){var e=xe();if(!Le())throw Ye("Expected colon.");t.addEntry(e,W())}}while(je());if(!He())throw Ye("Expected closing curly bracket.");return t}return!1},U=function(){if(Ue()){for(var t=new List;h(),t.add(W()),je(););if(!ze())throw Ye("Expected closing bracket.");return t}return!1},z=function(){if(d())throw Ye("Not allowed to nest aggregation functions.");if(Me()){var t=Ct(AggregateFunction.latestParsed);if(Vt(),p(),Je(),oe()&&t.setDistinct(),Je(),AggregateFunction.latestParsed.parametric()){for(var e=0;q(),e++,je(););try{t.verifyParsedParameterCount(e)}catch(t){throw Ye(t)}}if(!ke())throw Ye("Expected closing parentheses.");return Dt(),g(),t}throw Ye("Expected opening parentheses.")},J=function(){if(Me()){var t=Bt(_Function.latestParsed);if(Vt(),_Function.latestParsed.parametric()){for(var e=0;q(),e++,je(););try{t.verifyParsedParameterCount(e)}catch(t){throw Ye(t)}}if(!ke())throw Ye("Expected closing parentheses.");return Dt(),t}throw Ye("Expected opening parentheses.")},q=function(){Tt(W())},X=function(t){t=!t;if(Je(),Fe(Xe()))return!1;if(Ce())for(;Ne()&&!Ce();)n+=Xe(),r++;else if(!Ce())for(;Ne()&&!s[Xe()];)n+=Xe(),r++;return!!(0<n.length&&Re())&&(t&&c.variable(xe()),!0)},Q=function(){return X(!0)},Y=function(){return X(!1)},Z=function(){return X(!1)},$=function(){return X(!0)},tt=function(){if(Je(),!Le())return!1;var t="";if(Ce())for(;Ne()&&!Ce();)t+=Xe(),r++;else if(!Ce())for(;Ne()&&!s[Xe()];)t+=Xe(),r++;if(""==t)throw Ye("Expecting label name.");return c.label(t),tt(),!0},et=function(){if(Je(),!Le())return!1;var t="";if(Ce())for(;Ne()&&!Ce();)t+=Xe(),r++;else if(!Ce())for(;Ne()&&!s[Xe()];)t+=Xe(),r++;if(""==t)throw Ye("Expecting type name.");return c.type(t),!0},nt=function(){if(Je(),Ge()){if(!it())throw Ye("Expecting at least one property.");if(!He())throw Ye("Expecting closing curly brackets.");return!0}return!1},it=function(){if(!rt())return!1;if(c.propertyKey(xe()),!Le())throw Ye("Expected colon.");return c.propertyValue(W()),!je()||it()},rt=function(){if(Je(),Fe(Xe()))return!1;if(Ce())for(;Ne()&&!Ce();)n+=Xe(),r++;else if(!Ce())for(;Ne()&&!s[Xe()];)n+=Xe(),r++;return 0!=n.length},ot=function(){if(_e()){for(o=!0;Ne()&&!_e();)We(),n+=Xe(),r++;o=!1}else{if(!Be())return!1;for(o=!0;Ne()&&!Be();)We(),n+=Xe(),r++;o=!1}return!0},ut=function(){if(!ot())if(ye())n=parseFloat(n);else if(ue())n=!0;else if(se())n=!1;else{if(!ae())return!1;n=null}return!0},st=function(){if(Je(),ne()){if(!Q())throw Ye("Expected alias variable key.");return c.as(xe()),!0}return!1},at=function(){if(Je(),ne()){if(!Y())throw Ye("Expected alias variable key.");return c.as(xe()),!0}return!1},ct=function(){if(Je(),ne()){if(!Z())throw Ye("Unwinded collection must be aliased.");return!0}return!1};function ht(t,e){var n=t,i=e;this.getObject=function(){return n.statement().getVariable(i).getObject()},this.value=function(t){return n.statement().getVariable(i).value(t)},this.getKey=function(){return i},this.type=function(){return n.statement().getVariable(i).getObject().type()},this.groupByKey=function(){var t=n.statement().getVariable(i).getObject();return t.groupByKey&&t.groupByKey()||t},this.groupByValue=function(){var t=n.statement().getVariable(i).getObject();return t.groupByValue&&t.groupByValue()||t}}function ft(t){var e=t,n=0,i=void 0,r=void 0,o=this,u=this,s=0;this.element=function(){return e},this.precalculate=function(){n=0,i=this.value(),r=this.value,c(a)};var a=function(){if(i&&0==n)return n++,i;if(i&&1==n){var t=i;return i=void 0,n=0,c(r),t}},c=function(t){o.value=t,o.groupByKey=o.value,o.groupByValue=o.value};this.elementValueContext=function(){return u},this.elementValue=function(){return e.value.call(u)},this.type=e.type,this.value=this.elementValue,this.groupByKey=e.groupByKey||this.elementValue,this.groupByValue=e.groupByValue||this.elementValue,this.hasKey=function(){return e.getKey&&e.getKey()},this.parsedParameterCount=function(){return s},this.verifyParsedParameterCount=function(t){e.constructor!=_Function&&e.constructor!=AggregateFunction||(s=t,e.verifyParsedParameterCount(s))},this.non_deterministic=function(){return e.non_deterministic()},this.mappable=function(){if(e.mappable&&!e.mappable())return!1;if(this.p)for(var t=0;t<this.p.length;t++)if(this.p[t].mappable&&!this.p[t].mappable())return!1;return!0}}function lt(t){ft.call(this,t);var e,n,i=!1;this.setReducer=function(t){n=t},this.setGroupBy=function(t){e=t},this.getGroupBy=function(){return e},this.getReducerId=function(){return n},this.initializeIfNecessary=function(){this.initialize()},this.initialize=function(){return this.element().initialize.call(this.elementValueContext())},this.aggregate=function(){return this.element().aggregate.call(this.elementValueContext())},this.value=function(){return this.element().value.call(this.elementValueContext())},this.groupByKey=function(){return this.element().groupByKey.call(this.elementValueContext())},this.groupByValue=function(){return this.element().groupByValue.call(this.elementValueContext())},this.hasKey=function(){return this.element().getKey&&this.element().getKey()},this.distinct=function(){return i},this.setDistinct=function(){i=!0},this.mappable=function(){return!1}}(lt.prototype=Object.create(ft.prototype)).constructor=lt;var dt=[],pt=[],gt=[],yt=function(){pt=[],gt=[]},vt=function(){return 0==pt.length?null:pt[pt.length-1]},bt=function(){return 0==gt.length?null:gt[gt.length-1]};this.addLayer=function(){dt.push({output:pt,operators:gt,rollbackPosition:e}),yt()},this.finishLayer=function(){var t=dt.pop();pt=t.output,gt=t.operators,e=t.rollbackPosition};var wt=function(t){return pt.push(t),vt()},mt=function(t){return gt.push(t),bt()},Rt=function(t,e){return!!(t.leftAssociativity()&&t.precedence()<=e.precedence())||!!(t.rightAssociativity()&&t.precedence()<e.precedence())},xt=function(t,e){t.lookups||(t.lookups=[]),t.lookups.push({function:_Function.f.object_lookup,index:new ft(new Constant(e))})},Nt=function(t,e){t.lookups||(t.lookups=[]),t.lookups.push({function:_Function.f.array_lookup,index:new ft(e)})},Ot=function(){},Et=function(t){return wt({isAtom:!0,v:new ft(new Constant(t))}).v},At=function(){for(var t=c.statement().context().variables(),e=0;e<t.length;e++)Pt(t[e].getObjectKey()),c.expression()},Pt=function(t){return wt({isAtom:!0,isVariable:!0,v:new ft(new ht(c,t))}).v},It=function(t){return wt({isAtom:!0,v:new ft(t)}).v},Ft=function(){vt().v.element().constructor==Pattern&&pt.pop()},Tt=function(t){return wt({isAtom:!0,v:new ft(t)}).v},St=function(t){return wt({isAtom:!0,v:new ft(t)}).v},Kt=function(t){return wt({isAtom:!0,v:new ft(t)}).v},_t=function(t){return wt({isAtom:!0,v:new ft(t)}).v},Bt=function(t){return mt({isFunction:!0,v:new ft(t)}).v},Ct=function(t){return mt({isAggregateFunction:!0,isFunction:!0,v:new lt(t)}).v},Lt=function(t){for(;0<gt.length&&(gt.slice(-1)[0].isOperator||gt.slice(-1)[0].isFunction)&&Rt(t,gt.slice(-1)[0].v.element());)pt.push(gt.pop());return mt({isOperator:!0,v:new ft(t)}).v},Vt=function(){mt({leftParentheses:!0})},Dt=function(){for(;0<gt.length&&!gt.slice(-1)[0].leftParentheses;)pt.push(gt.pop());gt.pop()};this.getExpression=function(){for(;0<gt.length;)pt.push(gt.pop());for(var t,e,n=addArrayFunctions([]),i=[],r=!1;0<pt.length;){if((e=pt.shift()).isOperator)e.v.rhs=n.pop().v,e.v.lhs=n.pop().v;else if(e.isFunction){e.v.p=[];for(var o=0;o<e.v.parsedParameterCount();o++)e.v.p.unshift(n.pop().v);e.isAggregateFunction&&(t=t||[],e.v.p=e.v.p,t.push(e.v)),e.v.element().non_deterministic&&(r=!0)}if(e.isVariable&&i.push(e.v.element().getKey()),e.v.lookups)for(var u,s,a=e.v.lookups;a&&0<a.length;)s=e.v,u=a.shift(),e.v=new ft(u.function),e.v.p=[s,u.index];n.push(e)}return yt(),0==n.length?null:new Expression(n.pop().v,"expr",t,c.statement().context(),i,r)};var jt=function(){return ge(KeyWord.f.CREATE)},Wt=function(){return ge(KeyWord.f.MATCH)},Mt=function(){return ge(KeyWord.f.MERGE)},kt=function(){return ge(KeyWord.f.SHORTESTPATH)},Gt=function(){var t;return 0<(t=_Function.isFunction(i,r))&&(r+=t,!!Me(!0,!0)||(r-=t,!1))},Ht=function(){var t;return 0<(t=AggregateFunction.isAggregateFunction(i,r))&&(r+=t,!0)},Ut=function(t){return ge(KeyWord.f.WITH,t)},zt=function(){return ge(KeyWord.f.RETURN)},Jt=function(){return ge(KeyWord.f.INTO)},qt=function(){return ge(KeyWord.f.LIMIT)},zt=function(){return ge(KeyWord.f.RETURN)},Xt=function(){return ge(KeyWord.f.WHERE)},Qt=function(){return ge(KeyWord.f.LOAD)},Yt=function(){return ge(KeyWord.f.UNWIND)},Zt=function(){return ge(KeyWord.f.CSV)},$t=function(){return ge(KeyWord.f.JSON)},te=function(){return ge(KeyWord.f.HEADERS)},ee=function(){return ge(KeyWord.f.FROM)},ne=function(){return ge(KeyWord.f.AS)},ie=function(){return ge(KeyWord.f.FIELDTERMINATOR)},re=function(){return ge(KeyWord.f.SET)},oe=function(){return ge(KeyWord.f.DISTINCT)},ue=function(){return ge(KeyWord.f.TRUE)},se=function(){return ge(KeyWord.f.FALSE)},ae=function(){return ge(KeyWord.f.NULL)},ce=function(){return ge(KeyWord.f.CASE)},he=function(){return ge(KeyWord.f.WHEN)},fe=function(){return ge(KeyWord.f.THEN)},le=function(){return ge(KeyWord.f.ELSE)},de=function(){return ge(KeyWord.f.END)},pe=function(){var t;return 0<(t=Operator.isOperator(i,r))&&(r+=t,!0)},ge=function(t,e){var n;return 0<(n=KeyWord.isKeyWord(i,r))&&KeyWord.latestParsed===t&&(e||KeyWord.latestParsed.action(c),r+=n,!0)},ye=function(){Je();var t=!1;if(Ie()&&(be(),t=!0),!Te()){if(t)throw Ye("Expected number.");return!1}for(be();Te();)be();if(Ke()){if(be(),!Te())throw Ye("Expected one or more integers after decimal point.");for(be();Te();)be()}return Je(),!0},ve=function(){if(Je(),!Te())return!1;for(be();Te();)be();return Je(),!0},be=function(){n+=qe()},we=function(){e=r},me=function(){null==e||r<e||(r-=r-e,n="",e=void 0)},Re=function(){return!(_Function.isFunction(n,0)&&Me(!0)||AggregateFunction.isAggregateFunction(n,0)&&Me(!0)||KeyWord.isKeyWord(n,0))||(r-=n.length,!1)},xe=function(){var t=n;return n="",t},Ne=function(){return r<i.length},Oe=function(t,e,n){n=!n;return e||Je(),Xe()==t&&(n&&r++,!0)},Ee=function(){return Oe("<")},Ae=function(){return Oe(">")},Pe=function(){return Oe("-")},Ie=function(){return Oe("-")},Fe=function(t){return!isNaN(parseInt(t))},Te=function(){var t=Fe(Xe());return t&&r++,t},Se=function(){return Oe("*")},Ke=function(){return Oe(".")},_e=function(){return("\\"!=qe()||"'"!=Xe()||!o)&&Oe("'",!0)},Be=function(){return("\\"!=qe()||'"'!=Xe()||!o)&&Oe('"',!0)},Ce=function(){return("\\"!=qe()||"`"!=Xe()||!o)&&Oe("`",!0)},Le=function(){return Oe(":")},Ve=function(){return Oe("=")},De=function(){return Oe("+")&&Oe("=")},je=function(){return Oe(",")},We=function(){return Oe("\\",!0)},Me=function(t,e){return Oe("(",e,t)},ke=function(){return Oe(")")},Ge=function(){return Oe("{")},He=function(){return Oe("}")},Ue=function(){return Oe("[")},ze=function(){return Oe("]")},Je=function(){for(;" "==Xe()||"\n"==Xe()||"\t"==Xe()||"\r"==Xe();)r++},qe=function(){return i.charAt(r-1)},Xe=function(){return i.charAt(r)},Qe=function(){return' Parsed "'+i.substring(0,r)+'". Got "'+Xe()+'"'},Ye=function(t){return yt(),t+Qe()}}}function LinkedList(){var i=null,e=null,r=0;function n(t){var e=t,n=null,i=null;this.get=function(){return e},this.setPrevious=function(t){n=t},this.setNext=function(t){(i=t)&&t.setPrevious(this)},this.previous=function(){return n},this.next=function(){return i}}this.add=function(t){e=e?(e.setNext(new n(t)),e.next()):i=new n(t),r++},this.removeLast=function(){e&&(e.previous()?(e=e.previous()).setNext(null):e.previous()||(e=i=null),r--)},this.head=function(){return i},this.size=function(){return r},this.toArray=function(){for(var t=i,e=new Array(r),n=0;t;)e[n++]=t.get(),t.next();return e}}{function printStackTrace(t){var e=t;try{for(;e;)console.log(e),e=e.caller}catch(t){}}function getUNIXTimestamp(){return(new Date).valueOf()}function addArrayFunctions(i){return i.contains=function(t){for(var e=0;e<i.length;e++)if(t==i[e])return!0;return!1},i.toLowerCase=function(){for(var t=[],e=0;e<i.length;e++)t.push(i[e].toLowerCase&&i[e].toLowerCase()||i[e]);return t},i.toUpperCase=function(){for(var t=[],e=0;e<i.length;e++)t.push(i[e].toUpperCase&&i[e].toUpperCase()||i[e]);return t},i.get=function(){return i},i.last=function(){return i[i.length-1]},i.beforeLast=function(){return i[i.length-2]},i.value=function(){return i},i.join=function(t){for(var e="",n=0;n<i.length;n++)e+=(0<n?t:"")+i[n];return e},i.trim=function(){for(var t=new Array(i.length),e=0;e<i.length;e++)t[e]=i[e].trim();return t},i}function addAssociativeArrayFunctions(e){return e.getProperty||(e.getProperty=function(t){return e[t]}),e.getProperties||(e.getProperties=function(){return e}),e.getKeys||(e.getKeys=function(){var t=[];for(key in e)e[key].constructor!==Function&&t.push(key);return t}),e}function clean(t){if(t&&t.constructor==String)return t.replace(/\0/g,"");if(t&&(t.constructor==NodeReference||t.constructor==RelationshipReference))return clean(t.value());if(t){for(var e in t)"function"!=typeof t[e]?t[e]&&(t[e]=clean(t[e])):delete t[e];t.fromNode&&(t.fromNode=clean(t.fromNode)),t.toNode&&(t.toNode=clean(t.toNode))}return t}function NodeReference(t,e){var n=t,i=e;this.nodeId=function(){return i},this.id=this.nodeId,this.getNode=function(){return n.getNodeById(i)},this.getObject=function(){return n.getNodeById(i)},this.value=function(){return n.getNodeById(i).toObject()},this.getData=this.value,this.getProperty=function(t){return n.getNodeById(i).getLocalProperty(t)},this.getProperties=function(){return this.value().getProperties()},this.getLabels=function(){return this.value().getLabels()},this.getKeys=function(){return this.value().getProperties().getKeys()},this.groupByKey=this.nodeId}function RelationshipReference(t,e){var n=t,i=e;this.relationshipId=function(){return i},this.id=this.relationshipId,this.getRelationship=function(){return n.getRelationshipById(i)},this.getObject=function(){return n.getRelationshipById(i)},this.value=function(){return n.getRelationshipById(i).toObject()},this.startNode=function(){return this.getRelationship().getFromNode().get()},this.endNode=function(){return this.getRelationship().getToNode().get()},this.getData=this.value,this.getProperty=function(t){return n.getRelationshipById(i).getLocalProperty(t)},this.getProperties=function(){return this.value().getProperties()},this.getKeys=function(){return this.value().getProperties().getKeys()},this.getType=function(){return this.value().getType()},this.groupByKey=this.relationshipId}}var db=new DB(this),statement=new Statement(this),parser=new Parser(this),dataDownloadProxy;this.execute=function(t,e,o){statement.clear();var u=arguments.callee;try{self.onerror=function(t,e,n,i,r){console.log(t),o(t),printStackTrace(u)}}catch(t){}try{parser.parse(t),statement.setSuccessCallback(e),this.run()}catch(t){o(t),printStackTrace(u);try{console.log(t)}catch(t){}}},this.addGraph=function(t,e){for(var n=0;n<t.length;n++)db.addNode(t[n]);for(n=0;n<e.length;n++)db.addRelationship(e[n])},this.resetDataBase=function(){db=new DB(this)},this.setDataDownloadProxy=function(t){dataDownloadProxy=t},this.getDataDownloadProxy=function(){return dataDownloadProxy},this.db=function(){return db},this.optional=function(){return this},this.create=function(){return statement.addOperation(new Create(statement)),this},this.match=function(){return statement.addOperation(new Match(statement)),this},this.pattern=function(){return statement.context().addPattern(),this},this.node=function(){return statement.context().addNode(new Node(db)),this},this.relationship=function(){return statement.context().addRelationship(new Relationship(db)),this},this.expression=function(){return statement.context().expression(parser.getExpression()),this},this.variable=function(t){return statement.context().variable(t),this},this.variableExists=function(t){return statement.hasVariable(t)},this.getVariable=function(t){return statement.getVariable(t)},this.lastObject=function(){return statement.context().getLast()},this.label=function(t){return statement.context().getLast().setLabel(t),this},this.type=function(t){return statement.context().getLast().setType(t),this},this.readProperty=function(t){return statement.context().getLast().readProperty(t),this},this.propertyValue=function(t){return statement.context().getLast().setProperty(statement.getPropertyKey(),t),this},this.propertyKey=function(t){return statement.setPropertyKey(t),this},this.as=function(t){return statement.context().getLast().setAlias(t),this},this.leftDirection=function(){return statement.context().getLast().setLeftDirection(!0),this},this.setter=function(){return statement.addOperation(new Setter),this},this.relStart=function(){return this},this.relMiddle=function(){return this},this.relEnd=function(){return this},this.rightDirection=function(){return statement.context().getLast().setRightDirection(!0),this},this.variableProperty=function(t){return this},this.equals=function(){return this},this.constant=function(t){return statement.context().constant(t),this},this.load=function(){return statement.addOperation(new Load(statement)),this},this.csv=function(){return statement.context().csv(),this},this.json=function(){return statement.context().json(),this},this.headers=function(){return statement.context().headers(),this},this._with=function(){return statement.addOperation(new With(statement)),this},this._return=function(){return statement.addOperation(new Return(statement)),this},this.into=function(){return this},this.insertInto=function(t){statement.addOperation(new Inserter(statement.engine().db(),t))},this.merge=function(){return statement.addOperation(new Merge(statement)),this},this.unwind=function(){return statement.addOperation(new Unwind(statement)),this},this.limit=function(t){return statement.context().limit(t),this},this.where=function(t){return statement.context().where(t),this},this.statement=function(){return statement},this.operation=function(){return statement.context().type()},this.context=function(){return statement.context().getLast()},this.operationContext=function(){return statement.context()},this.run=function(){switch(statement.context().type()){case"Match":case"With":throw"A "+statement.context().type()+"-statement cannot conclude the query."}statement.operations()[0].run()}}var Cypher_context_is_worker=null==this.document,isStandaloneJSEngine=!1,Cypher_script_path=function(){if(Cypher_context_is_worker)return"";var t=this.document.getElementsByTagName("script");return t[t.length-1].src}();try{module&&(isStandaloneJSEngine=!0)}catch(e){isStandaloneJSEngine=!1}function Cypher(t){var r,o,u,e=!t||!t.runInWebWorker;if(Cypher_context_is_worker&&!isStandaloneJSEngine)try{var i=new CypherJS;t&&t.dataDownloadProxy&&i.setDataDownloadProxy(t.dataDownloadProxy),self.onmessage=function(t){var e=t.data,n=e.action;switch(n){case"query":return void i.execute(e.statementText,function(t){self.postMessage({action:n,success:!0,results:t})},function(t){self.postMessage({action:n,error:!0,message:t})});case"addGraph":try{i.addGraph(e.nodes,e.edges)}catch(t){return void self.postMessage({action:n,error:!0,message:t})}return void self.postMessage({action:n,success:!0});case"resetDataBase":return i.resetDataBase(),void self.postMessage({action:n})}}}catch(t){}else Cypher_context_is_worker||e||isStandaloneJSEngine?(isStandaloneJSEngine||!isStandaloneJSEngine&&!Cypher_context_is_worker&&e)&&(i=new CypherJS,t&&t.dataDownloadProxy&&i.setDataDownloadProxy(t.dataDownloadProxy),this.execute=function(t,e,n){i.execute(t,e,n)}):((u=new Worker(Cypher_script_path)).onmessage=function(t){var e=t.data;switch(e.action){case"query":case"addGraph":return void(e.success?r(e.results):e.error&&o(e.message));case"resetDataBase":return void(r&&r())}},this.execute=function(t,e,n){r=e,o=n,u.postMessage({action:"query",statementText:t})},this.addGraph=function(t,e,n,i){r=n,o=i,u.postMessage({action:"addGraph",nodes:t,edges:e})},this.resetDataBase=function(t){r=t?_successCallback:function(){},u.postMessage({action:"resetDataBase"})})}Object.values||(Object.values=function(t){var e,n=[];for(e in t)n.push(t[e]);return n}),Object.keys||(Object.keys=function(t){var e,n=[];for(e in t)n.push(e);return n}),Array.prototype.fill||(Array.prototype.fill=function(t){for(var e=Object(this),n=0;n<e.length;n++)e[n]=t;return e}),Array.prototype.concat||(Array.prototype.concat=function(t){for(var e=Object(this),n=new Array(e.length+t.length),i=0;i<e.length;i++)n[i]=e[i];for(;i<n.length;i++)n[i]=t[i-e.length];return n}),Number.MAX_SAFE_INTEGER||(Number.MAX_SAFE_INTEGER=9007199254740991),Cypher_context_is_worker&&new Cypher;try{module.exports={Cypher:Cypher}}catch(e){}
